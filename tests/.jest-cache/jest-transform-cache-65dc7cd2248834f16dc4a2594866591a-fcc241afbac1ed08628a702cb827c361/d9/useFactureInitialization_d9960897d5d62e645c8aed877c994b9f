4b6c5fd02d907c46dd331b50c5857b13
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useFactureInitialization = void 0;
var _react = require("react");
var _factureConstants = require("../../../constants/factureConstants");
const useFactureInitialization = (mode, idFacture, factureActions) => {
  const [isFullyInitialized, setIsFullyInitialized] = (0, _react.useState)(false);
  const [isInitialLoadDone, setIsInitialLoadDone] = (0, _react.useState)(false);
  const [initialFormData, setInitialFormData] = (0, _react.useState)({});

  // âœ… PROTECTION TOTALE contre les appels multiples
  const initRef = (0, _react.useRef)({
    hasInitialized: false,
    currentMode: null,
    currentId: null,
    isProcessing: false
  });
  const {
    chargerFacture,
    fetchProchainNumeroFacture,
    chargerClients,
    setFacture,
    setIsLoading,
    getFormData
  } = factureActions;

  // âœ… EFFET UNIQUE simplifiÃ© avec protection totale
  (0, _react.useEffect)(() => {
    const currentMode = mode;
    const currentId = idFacture;
    console.log('ðŸ” useFactureInitialization - useEffect dÃ©clenchÃ©:', {
      mode: currentMode,
      idFacture: currentId,
      typeIdFacture: typeof currentId
    });

    // âœ… VERIFICATIONS DE SECURITE
    // 1. VÃ©rifier si dÃ©jÃ  en cours de traitement
    if (initRef.current.isProcessing) {
      console.log('â¸ï¸ Traitement dÃ©jÃ  en cours, abandon');
      return;
    }

    // 2. VÃ©rifier si dÃ©jÃ  initialisÃ© pour ces paramÃ¨tres EXACTS
    if (initRef.current.hasInitialized && initRef.current.currentMode === currentMode && initRef.current.currentId === currentId) {
      console.log('âœ… DÃ©jÃ  initialisÃ© pour ces paramÃ¨tres, skip');
      return;
    }

    // 3. Si mode VIEW sans ID, ne pas initialiser
    if ((currentMode === _factureConstants.FORM_MODES.VIEW || currentMode === _factureConstants.FORM_MODES.EDIT) && !currentId) {
      console.log('âŒ Mode VIEW/EDIT sans ID, abandon');
      setIsLoading(false);
      return;
    }

    // âœ… DEBUT DU TRAITEMENT
    const initializeData = async () => {
      // Marquer comme en cours
      initRef.current.isProcessing = true;
      let factureDataRef = null;
      try {
        console.log('ðŸš€ DÃ©but initialisation pour mode:', currentMode, 'ID:', currentId);
        if (currentMode === _factureConstants.FORM_MODES.CREATE) {
          // âœ… MODE CREATION
          console.log('ðŸ†• Initialisation mode crÃ©ation');
          const today = new Date();
          setFacture(prev => ({
            ...prev,
            dateFacture: today.toISOString().split('T')[0],
            numeroFacture: '',
            idClient: null,
            lignes: []
          }));
          await fetchProchainNumeroFacture(today.getFullYear());
        } else if ((currentMode === _factureConstants.FORM_MODES.VIEW || currentMode === _factureConstants.FORM_MODES.EDIT) && currentId) {
          // âœ… MODE VIEW/EDIT avec ID
          console.log('ðŸ”„ Chargement facture pour mode:', currentMode, 'ID:', currentId);
          const loadedFacture = await chargerFacture(currentId);
          console.log('ðŸ“¦ DonnÃ©es facture chargÃ©es:', loadedFacture);

          // Stocker les donnÃ©es pour l'initialisation
          factureDataRef = loadedFacture;
        }

        // âœ… FINALISATION
        console.log('âœ… Initialisation terminÃ©e pour mode:', currentMode);

        // Marquer comme traitÃ©
        initRef.current.hasInitialized = true;
        initRef.current.currentMode = currentMode;
        initRef.current.currentId = currentId;
        setIsInitialLoadDone(true);
        setIsLoading(false);

        // âœ… CORRECTION: Attendre plus longtemps pour que les donnÃ©es se propagent
        if (currentMode === _factureConstants.FORM_MODES.CREATE) {
          // Mode crÃ©ation
          setTimeout(() => {
            const finalFormData = getFormData();
            console.log('ðŸ“Š DonnÃ©es finales (CREATE):', finalFormData);
            setInitialFormData(finalFormData);
            setIsFullyInitialized(true);
          }, 300);
        } else if (factureDataRef) {
          // âœ… ChangÃ© de factureData Ã  factureDataRef
          // Mode EDIT/VIEW : utiliser directement factureDataRef de l'API
          setTimeout(() => {
            console.log('âœ… Utilisation des donnÃ©es API directes:', factureDataRef);
            setInitialFormData({
              numeroFacture: factureDataRef.numeroFacture || '',
              dateFacture: factureDataRef.dateFacture || '',
              idClient: factureDataRef.idClient || null,
              lignes: factureDataRef.lignes || [],
              ristourne: factureDataRef.ristourne || 0,
              montantTotal: factureDataRef.montantTotal || 0,
              totalAvecRistourne: factureDataRef.totalAvecRistourne || 0
            });
            setIsFullyInitialized(true);
          }, 500);
        }
      } catch (error) {
        console.error('âŒ Erreur lors de l\'initialisation:', error);
        setIsLoading(false);
      } finally {
        initRef.current.isProcessing = false;
      }
    };

    // DÃ©marrer l'initialisation
    initializeData();
  }, [mode, idFacture]); // âœ… DEPENDANCES MINIMALES

  // âœ… Cleanup lors du dÃ©montage
  (0, _react.useEffect)(() => {
    return () => {
      console.log('ðŸ§¹ Cleanup useFactureInitialization');
      initRef.current = {
        hasInitialized: false,
        currentMode: null,
        currentId: null,
        isProcessing: false
      };
    };
  }, []);
  return {
    isFullyInitialized,
    setIsFullyInitialized,
    isInitialLoadDone,
    initialFormData,
    setInitialFormData
  };
};
exports.useFactureInitialization = useFactureInitialization;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX2ZhY3R1cmVDb25zdGFudHMiLCJ1c2VGYWN0dXJlSW5pdGlhbGl6YXRpb24iLCJtb2RlIiwiaWRGYWN0dXJlIiwiZmFjdHVyZUFjdGlvbnMiLCJpc0Z1bGx5SW5pdGlhbGl6ZWQiLCJzZXRJc0Z1bGx5SW5pdGlhbGl6ZWQiLCJ1c2VTdGF0ZSIsImlzSW5pdGlhbExvYWREb25lIiwic2V0SXNJbml0aWFsTG9hZERvbmUiLCJpbml0aWFsRm9ybURhdGEiLCJzZXRJbml0aWFsRm9ybURhdGEiLCJpbml0UmVmIiwidXNlUmVmIiwiaGFzSW5pdGlhbGl6ZWQiLCJjdXJyZW50TW9kZSIsImN1cnJlbnRJZCIsImlzUHJvY2Vzc2luZyIsImNoYXJnZXJGYWN0dXJlIiwiZmV0Y2hQcm9jaGFpbk51bWVyb0ZhY3R1cmUiLCJjaGFyZ2VyQ2xpZW50cyIsInNldEZhY3R1cmUiLCJzZXRJc0xvYWRpbmciLCJnZXRGb3JtRGF0YSIsInVzZUVmZmVjdCIsImNvbnNvbGUiLCJsb2ciLCJ0eXBlSWRGYWN0dXJlIiwiY3VycmVudCIsIkZPUk1fTU9ERVMiLCJWSUVXIiwiRURJVCIsImluaXRpYWxpemVEYXRhIiwiZmFjdHVyZURhdGFSZWYiLCJDUkVBVEUiLCJ0b2RheSIsIkRhdGUiLCJwcmV2IiwiZGF0ZUZhY3R1cmUiLCJ0b0lTT1N0cmluZyIsInNwbGl0IiwibnVtZXJvRmFjdHVyZSIsImlkQ2xpZW50IiwibGlnbmVzIiwiZ2V0RnVsbFllYXIiLCJsb2FkZWRGYWN0dXJlIiwic2V0VGltZW91dCIsImZpbmFsRm9ybURhdGEiLCJyaXN0b3VybmUiLCJtb250YW50VG90YWwiLCJ0b3RhbEF2ZWNSaXN0b3VybmUiLCJlcnJvciIsImV4cG9ydHMiXSwic291cmNlcyI6WyJ1c2VGYWN0dXJlSW5pdGlhbGl6YXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyBGT1JNX01PREVTIH0gZnJvbSAnLi4vLi4vLi4vY29uc3RhbnRzL2ZhY3R1cmVDb25zdGFudHMnO1xyXG5cclxuZXhwb3J0IGNvbnN0IHVzZUZhY3R1cmVJbml0aWFsaXphdGlvbiA9IChtb2RlLCBpZEZhY3R1cmUsIGZhY3R1cmVBY3Rpb25zKSA9PiB7XHJcbiAgY29uc3QgW2lzRnVsbHlJbml0aWFsaXplZCwgc2V0SXNGdWxseUluaXRpYWxpemVkXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbaXNJbml0aWFsTG9hZERvbmUsIHNldElzSW5pdGlhbExvYWREb25lXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbaW5pdGlhbEZvcm1EYXRhLCBzZXRJbml0aWFsRm9ybURhdGFdID0gdXNlU3RhdGUoe30pO1xyXG5cclxuICAvLyDinIUgUFJPVEVDVElPTiBUT1RBTEUgY29udHJlIGxlcyBhcHBlbHMgbXVsdGlwbGVzXHJcbiAgY29uc3QgaW5pdFJlZiA9IHVzZVJlZih7XHJcbiAgICBoYXNJbml0aWFsaXplZDogZmFsc2UsXHJcbiAgICBjdXJyZW50TW9kZTogbnVsbCxcclxuICAgIGN1cnJlbnRJZDogbnVsbCxcclxuICAgIGlzUHJvY2Vzc2luZzogZmFsc2VcclxuICB9KTtcclxuXHJcbiAgY29uc3QgeyBjaGFyZ2VyRmFjdHVyZSwgZmV0Y2hQcm9jaGFpbk51bWVyb0ZhY3R1cmUsIGNoYXJnZXJDbGllbnRzLCBzZXRGYWN0dXJlLCBzZXRJc0xvYWRpbmcsIGdldEZvcm1EYXRhIH0gPSBmYWN0dXJlQWN0aW9ucztcclxuXHJcbiAgLy8g4pyFIEVGRkVUIFVOSVFVRSBzaW1wbGlmacOpIGF2ZWMgcHJvdGVjdGlvbiB0b3RhbGVcclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgY29uc3QgY3VycmVudE1vZGUgPSBtb2RlO1xyXG4gICAgY29uc3QgY3VycmVudElkID0gaWRGYWN0dXJlO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygn8J+UjSB1c2VGYWN0dXJlSW5pdGlhbGl6YXRpb24gLSB1c2VFZmZlY3QgZMOpY2xlbmNow6k6Jywge1xyXG4gICAgICBtb2RlOiBjdXJyZW50TW9kZSxcclxuICAgICAgaWRGYWN0dXJlOiBjdXJyZW50SWQsXHJcbiAgICAgIHR5cGVJZEZhY3R1cmU6IHR5cGVvZiBjdXJyZW50SWRcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOKchSBWRVJJRklDQVRJT05TIERFIFNFQ1VSSVRFXHJcbiAgICAvLyAxLiBWw6lyaWZpZXIgc2kgZMOpasOgIGVuIGNvdXJzIGRlIHRyYWl0ZW1lbnRcclxuICAgIGlmIChpbml0UmVmLmN1cnJlbnQuaXNQcm9jZXNzaW5nKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfij7jvuI8gVHJhaXRlbWVudCBkw6lqw6AgZW4gY291cnMsIGFiYW5kb24nKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDIuIFbDqXJpZmllciBzaSBkw6lqw6AgaW5pdGlhbGlzw6kgcG91ciBjZXMgcGFyYW3DqHRyZXMgRVhBQ1RTXHJcbiAgICBpZiAoaW5pdFJlZi5jdXJyZW50Lmhhc0luaXRpYWxpemVkICYmIFxyXG4gICAgICAgIGluaXRSZWYuY3VycmVudC5jdXJyZW50TW9kZSA9PT0gY3VycmVudE1vZGUgJiYgXHJcbiAgICAgICAgaW5pdFJlZi5jdXJyZW50LmN1cnJlbnRJZCA9PT0gY3VycmVudElkKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgRMOpasOgIGluaXRpYWxpc8OpIHBvdXIgY2VzIHBhcmFtw6h0cmVzLCBza2lwJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyAzLiBTaSBtb2RlIFZJRVcgc2FucyBJRCwgbmUgcGFzIGluaXRpYWxpc2VyXHJcbiAgICBpZiAoKGN1cnJlbnRNb2RlID09PSBGT1JNX01PREVTLlZJRVcgfHwgY3VycmVudE1vZGUgPT09IEZPUk1fTU9ERVMuRURJVCkgJiYgIWN1cnJlbnRJZCkge1xyXG4gICAgICBjb25zb2xlLmxvZygn4p2MIE1vZGUgVklFVy9FRElUIHNhbnMgSUQsIGFiYW5kb24nKTtcclxuICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOKchSBERUJVVCBEVSBUUkFJVEVNRU5UXHJcbiAgICBjb25zdCBpbml0aWFsaXplRGF0YSA9IGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gTWFycXVlciBjb21tZSBlbiBjb3Vyc1xyXG4gICAgICBpbml0UmVmLmN1cnJlbnQuaXNQcm9jZXNzaW5nID0gdHJ1ZTtcclxuXHJcbiAgICAgIGxldCBmYWN0dXJlRGF0YVJlZiA9IG51bGw7XHJcbiAgICAgIFxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5qAIETDqWJ1dCBpbml0aWFsaXNhdGlvbiBwb3VyIG1vZGU6JywgY3VycmVudE1vZGUsICdJRDonLCBjdXJyZW50SWQpO1xyXG5cclxuICAgICAgICBpZiAoY3VycmVudE1vZGUgPT09IEZPUk1fTU9ERVMuQ1JFQVRFKSB7XHJcbiAgICAgICAgICAvLyDinIUgTU9ERSBDUkVBVElPTlxyXG4gICAgICAgICAgY29uc29sZS5sb2coJ/CfhpUgSW5pdGlhbGlzYXRpb24gbW9kZSBjcsOpYXRpb24nKTtcclxuICAgICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgIHNldEZhY3R1cmUocHJldiA9PiAoe1xyXG4gICAgICAgICAgICAuLi5wcmV2LFxyXG4gICAgICAgICAgICBkYXRlRmFjdHVyZTogdG9kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxyXG4gICAgICAgICAgICBudW1lcm9GYWN0dXJlOiAnJyxcclxuICAgICAgICAgICAgaWRDbGllbnQ6IG51bGwsXHJcbiAgICAgICAgICAgIGxpZ25lczogW11cclxuICAgICAgICAgIH0pKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgYXdhaXQgZmV0Y2hQcm9jaGFpbk51bWVyb0ZhY3R1cmUodG9kYXkuZ2V0RnVsbFllYXIoKSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICB9IGVsc2UgaWYgKChjdXJyZW50TW9kZSA9PT0gRk9STV9NT0RFUy5WSUVXIHx8IGN1cnJlbnRNb2RlID09PSBGT1JNX01PREVTLkVESVQpICYmIGN1cnJlbnRJZCkge1xyXG4gICAgICAgICAgLy8g4pyFIE1PREUgVklFVy9FRElUIGF2ZWMgSURcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SEIENoYXJnZW1lbnQgZmFjdHVyZSBwb3VyIG1vZGU6JywgY3VycmVudE1vZGUsICdJRDonLCBjdXJyZW50SWQpO1xyXG4gICAgICAgICAgY29uc3QgbG9hZGVkRmFjdHVyZSA9IGF3YWl0IGNoYXJnZXJGYWN0dXJlKGN1cnJlbnRJZCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+TpiBEb25uw6llcyBmYWN0dXJlIGNoYXJnw6llczonLCBsb2FkZWRGYWN0dXJlKTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gU3RvY2tlciBsZXMgZG9ubsOpZXMgcG91ciBsJ2luaXRpYWxpc2F0aW9uXHJcbiAgICAgICAgICBmYWN0dXJlRGF0YVJlZiA9IGxvYWRlZEZhY3R1cmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDinIUgRklOQUxJU0FUSU9OXHJcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBJbml0aWFsaXNhdGlvbiB0ZXJtaW7DqWUgcG91ciBtb2RlOicsIGN1cnJlbnRNb2RlKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBNYXJxdWVyIGNvbW1lIHRyYWl0w6lcclxuICAgICAgICBpbml0UmVmLmN1cnJlbnQuaGFzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIGluaXRSZWYuY3VycmVudC5jdXJyZW50TW9kZSA9IGN1cnJlbnRNb2RlO1xyXG4gICAgICAgIGluaXRSZWYuY3VycmVudC5jdXJyZW50SWQgPSBjdXJyZW50SWQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2V0SXNJbml0aWFsTG9hZERvbmUodHJ1ZSk7XHJcbiAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyDinIUgQ09SUkVDVElPTjogQXR0ZW5kcmUgcGx1cyBsb25ndGVtcHMgcG91ciBxdWUgbGVzIGRvbm7DqWVzIHNlIHByb3BhZ2VudFxyXG4gICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gRk9STV9NT0RFUy5DUkVBVEUpIHtcclxuICAgICAgICAgIC8vIE1vZGUgY3LDqWF0aW9uXHJcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmluYWxGb3JtRGF0YSA9IGdldEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OKIERvbm7DqWVzIGZpbmFsZXMgKENSRUFURSk6JywgZmluYWxGb3JtRGF0YSk7XHJcbiAgICAgICAgICAgIHNldEluaXRpYWxGb3JtRGF0YShmaW5hbEZvcm1EYXRhKTtcclxuICAgICAgICAgICAgc2V0SXNGdWxseUluaXRpYWxpemVkKHRydWUpO1xyXG4gICAgICAgICAgfSwgMzAwKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGZhY3R1cmVEYXRhUmVmKSB7ICAvLyDinIUgQ2hhbmfDqSBkZSBmYWN0dXJlRGF0YSDDoCBmYWN0dXJlRGF0YVJlZlxyXG4gICAgICAgICAgLy8gTW9kZSBFRElUL1ZJRVcgOiB1dGlsaXNlciBkaXJlY3RlbWVudCBmYWN0dXJlRGF0YVJlZiBkZSBsJ0FQSVxyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgVXRpbGlzYXRpb24gZGVzIGRvbm7DqWVzIEFQSSBkaXJlY3RlczonLCBmYWN0dXJlRGF0YVJlZik7XHJcbiAgICAgICAgICAgIHNldEluaXRpYWxGb3JtRGF0YSh7XHJcbiAgICAgICAgICAgICAgbnVtZXJvRmFjdHVyZTogZmFjdHVyZURhdGFSZWYubnVtZXJvRmFjdHVyZSB8fCAnJyxcclxuICAgICAgICAgICAgICBkYXRlRmFjdHVyZTogZmFjdHVyZURhdGFSZWYuZGF0ZUZhY3R1cmUgfHwgJycsXHJcbiAgICAgICAgICAgICAgaWRDbGllbnQ6IGZhY3R1cmVEYXRhUmVmLmlkQ2xpZW50IHx8IG51bGwsXHJcbiAgICAgICAgICAgICAgbGlnbmVzOiBmYWN0dXJlRGF0YVJlZi5saWduZXMgfHwgW10sXHJcbiAgICAgICAgICAgICAgcmlzdG91cm5lOiBmYWN0dXJlRGF0YVJlZi5yaXN0b3VybmUgfHwgMCxcclxuICAgICAgICAgICAgICBtb250YW50VG90YWw6IGZhY3R1cmVEYXRhUmVmLm1vbnRhbnRUb3RhbCB8fCAwLFxyXG4gICAgICAgICAgICAgIHRvdGFsQXZlY1Jpc3RvdXJuZTogZmFjdHVyZURhdGFSZWYudG90YWxBdmVjUmlzdG91cm5lIHx8IDBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHNldElzRnVsbHlJbml0aWFsaXplZCh0cnVlKTtcclxuICAgICAgICAgIH0sIDUwMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyZXVyIGxvcnMgZGUgbFxcJ2luaXRpYWxpc2F0aW9uOicsIGVycm9yKTtcclxuICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xyXG4gICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIGluaXRSZWYuY3VycmVudC5pc1Byb2Nlc3NpbmcgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBEw6ltYXJyZXIgbCdpbml0aWFsaXNhdGlvblxyXG4gICAgaW5pdGlhbGl6ZURhdGEoKTtcclxuXHJcbiAgfSwgW21vZGUsIGlkRmFjdHVyZV0pOyAvLyDinIUgREVQRU5EQU5DRVMgTUlOSU1BTEVTXHJcblxyXG4gIC8vIOKchSBDbGVhbnVwIGxvcnMgZHUgZMOpbW9udGFnZVxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZygn8J+nuSBDbGVhbnVwIHVzZUZhY3R1cmVJbml0aWFsaXphdGlvbicpO1xyXG4gICAgICBpbml0UmVmLmN1cnJlbnQgPSB7XHJcbiAgICAgICAgaGFzSW5pdGlhbGl6ZWQ6IGZhbHNlLFxyXG4gICAgICAgIGN1cnJlbnRNb2RlOiBudWxsLFxyXG4gICAgICAgIGN1cnJlbnRJZDogbnVsbCxcclxuICAgICAgICBpc1Byb2Nlc3Npbmc6IGZhbHNlXHJcbiAgICAgIH07XHJcbiAgICB9O1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGlzRnVsbHlJbml0aWFsaXplZCxcclxuICAgIHNldElzRnVsbHlJbml0aWFsaXplZCxcclxuICAgIGlzSW5pdGlhbExvYWREb25lLFxyXG4gICAgaW5pdGlhbEZvcm1EYXRhLFxyXG4gICAgc2V0SW5pdGlhbEZvcm1EYXRhXHJcbiAgfTtcclxufTsiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLGlCQUFBLEdBQUFELE9BQUE7QUFFTyxNQUFNRSx3QkFBd0IsR0FBR0EsQ0FBQ0MsSUFBSSxFQUFFQyxTQUFTLEVBQUVDLGNBQWMsS0FBSztFQUMzRSxNQUFNLENBQUNDLGtCQUFrQixFQUFFQyxxQkFBcUIsQ0FBQyxHQUFHLElBQUFDLGVBQVEsRUFBQyxLQUFLLENBQUM7RUFDbkUsTUFBTSxDQUFDQyxpQkFBaUIsRUFBRUMsb0JBQW9CLENBQUMsR0FBRyxJQUFBRixlQUFRLEVBQUMsS0FBSyxDQUFDO0VBQ2pFLE1BQU0sQ0FBQ0csZUFBZSxFQUFFQyxrQkFBa0IsQ0FBQyxHQUFHLElBQUFKLGVBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQzs7RUFFMUQ7RUFDQSxNQUFNSyxPQUFPLEdBQUcsSUFBQUMsYUFBTSxFQUFDO0lBQ3JCQyxjQUFjLEVBQUUsS0FBSztJQUNyQkMsV0FB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
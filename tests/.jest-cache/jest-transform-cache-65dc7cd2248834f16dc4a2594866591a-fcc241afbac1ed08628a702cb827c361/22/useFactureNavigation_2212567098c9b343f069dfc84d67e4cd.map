{"version":3,"names":["_react","require","_App","_useUnsavedChanges","_useAutoNavigationGuard","_modalSystem","_factureConstants","useFactureNavigation","mode","idFacture","initialFormData","getFormData","canDetectChanges","unregisterGuard","useNavigationGuard","guardId","hasUnsavedChanges","markAsSaved","requestNavigation","resetChanges","useUnsavedChanges","useAutoNavigationGuard","isActive","FORM_MODES","VIEW","debug","useEffect","handleNavigationBlocked","event","console","log","detail","callback","result","showConfirm","title","message","confirmText","cancelText","type","action","error","window","addEventListener","removeEventListener","handleSuccessfulSave","useCallback","callbacks","CREATE","onFactureCreated","onRetourListe","exports"],"sources":["useFactureNavigation.js"],"sourcesContent":["// src/hooks/facture/useFactureNavigation.js\r\n// ‚úÖ VERSION FINALE - 100% modalSystem, architecture unifi√©e\r\n\r\nimport { useEffect, useCallback } from 'react';\r\nimport { useNavigationGuard } from '../../../App';\r\nimport { useUnsavedChanges } from '../../../hooks/useUnsavedChanges';\r\nimport { useAutoNavigationGuard } from '../../../hooks/useAutoNavigationGuard';\r\nimport { showConfirm } from '../../../utils/modalSystem';\r\nimport { FORM_MODES } from '../../../constants/factureConstants';\r\n\r\n/**\r\n * Hook pour la gestion de la navigation et protection des modifications\r\n * Utilise modalSystem pour toutes les modales (navigation locale ET globale)\r\n */\r\nexport const useFactureNavigation = (mode, idFacture, initialFormData, getFormData, canDetectChanges) => {\r\n  const { unregisterGuard } = useNavigationGuard();\r\n  const guardId = `facture-form-${idFacture || 'new'}`;\r\n\r\n  // ‚úÖ Hook de d√©tection des modifications (g√®re automatiquement la modal locale via modalSystem)\r\n  const {\r\n    hasUnsavedChanges,\r\n    markAsSaved,\r\n    requestNavigation,\r\n    resetChanges\r\n  } = useUnsavedChanges(\r\n    initialFormData,\r\n    canDetectChanges() ? getFormData() : {},\r\n    false,\r\n    false\r\n  );\r\n\r\n  // ‚úÖ Protection automatique de navigation avec le hook g√©n√©ral\r\n  useAutoNavigationGuard(hasUnsavedChanges, {\r\n    isActive: mode !== FORM_MODES.VIEW && canDetectChanges(),\r\n    guardId: guardId,\r\n    debug: false\r\n  });\r\n\r\n  // ‚úÖ Gestion des √©v√©nements de navigation globale (menu, etc.) avec modalSystem\r\n  useEffect(() => {\r\n    if (mode === FORM_MODES.VIEW || !hasUnsavedChanges) return;\r\n\r\n    const handleNavigationBlocked = async (event) => {\r\n      console.log('üåç FACTURE - √âv√©nement navigation-blocked re√ßu:', event.detail);\r\n      \r\n      if (event.detail && event.detail.callback) {\r\n        try {\r\n          const result = await showConfirm({\r\n            title: \"Modifications non sauvegard√©es\",\r\n            message: \"Vous avez des modifications non sauvegard√©es. Souhaitez-vous vraiment quitter sans sauvegarder ?\",\r\n            confirmText: \"Quitter sans sauvegarder\",\r\n            cancelText: \"Continuer l'√©dition\",\r\n            type: 'warning'\r\n          });\r\n          \r\n          if (result.action === 'confirm') {\r\n            console.log('‚úÖ FACTURE - Navigation confirm√©e');\r\n            resetChanges();\r\n            unregisterGuard(guardId);\r\n            event.detail.callback();\r\n          } else {\r\n            console.log('‚ùå FACTURE - Navigation annul√©e');\r\n          }\r\n        } catch (error) {\r\n          console.error('‚ùå Erreur modal globale:', error);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('navigation-blocked', handleNavigationBlocked);\r\n    \r\n    return () => {\r\n      window.removeEventListener('navigation-blocked', handleNavigationBlocked);\r\n    };\r\n  }, [mode, hasUnsavedChanges, resetChanges, guardId, unregisterGuard]);\r\n\r\n  /**\r\n   * Gestion du succ√®s de sauvegarde avec navigation\r\n   */\r\n  const handleSuccessfulSave = useCallback((idFacture, message, callbacks) => {\r\n    console.log('‚úÖ FACTURE - Sauvegarde r√©ussie, nettoyage des modifications');\r\n    \r\n    markAsSaved();\r\n    resetChanges();\r\n    unregisterGuard(guardId);\r\n\r\n    // Navigation selon le mode\r\n    if (mode === FORM_MODES.CREATE && callbacks.onFactureCreated) {\r\n      callbacks.onFactureCreated(idFacture, message);\r\n    } else if (callbacks.onRetourListe) {\r\n      callbacks.onRetourListe(idFacture, true, message, 'success');\r\n    }\r\n  }, [mode, markAsSaved, resetChanges, guardId, unregisterGuard]);\r\n\r\n  return {\r\n    // √âtats de d√©tection des modifications\r\n    hasUnsavedChanges,\r\n    \r\n    // Fonction de navigation (utilise modalSystem automatiquement)\r\n    requestNavigation,\r\n    \r\n    // Utilitaires\r\n    handleSuccessfulSave,\r\n    markAsSaved,\r\n    resetChanges,\r\n    guardId,\r\n    unregisterGuard\r\n  };\r\n};"],"mappings":"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","ignoreList":[]}
{"version":3,"names":["_api","_interopRequireDefault","require","_urlHelper","_booleanHelper","_ParametreService","_formatters","_apiErrorHandler","_createLogger","e","__esModule","default","FactureService","constructor","factures","_cacheFacture","_parametreService","ParametreService","_delaiPaiementCache","log","createLogger","_getDelaiPaiement","result","getParametre","success","parametre","parseInt","valeurParametre","debug","warn","error","handleApiError","_determinerEtatBase","facture","etat","date_paiement","date_annulation","toBoolean","est_imprimee","_determinerEtatAffichage","etatBase","_estEnRetard","date_facture","numeroFacture","id","dateFacture","Date","aujourdhui","diffTemps","getTime","diffJours","Math","ceil","delaiPaiement","estEnRetard","_peutRecevoirPaiement","etatAffichage","etatsPayables","includes","_determinerEtatFacture","_clearDelaiPaiementCache","getFacturesPayables","annee","chargerFactures","facturesPayables","push","enrichirAvecEtatAffichage","factureEnrichie","enrichirFacturesAvecEtatAffichage","facturesEnrichies","normalizeFacture","booleanFields","normalizeBooleanFields","normalizeFactures","Array","isArray","normalizeBooleanFieldsArray","params","response","api","get","facturesData","facturesNormalisees","facturesTriees","sort","a","b","numA","split","numB","facturesAdaptees","map","idFacture","client","idClient","prenom","nom","email","montantTotal","parseFloat","datePaiement","dateAnnulation","est_envoyee","est_annulee","est_payee","getFacture","factureCache","factureData","Object","keys","montant_total","factureNormalisee","documentPath","factfilename","outputDirResponse","outputDir","backendUrl","factureFormattee","id_facture","numero_facture","ristourne","montantBrut","totalAvecRistourne","montantPayeTotal","montantRestant","nbPaiements","dateDernierPaiement","lignes","ligne","idLigne","description","quantite","prixUnitaire","totalLigne","idService","idUnite","noOrdre","descriptionDates","getProchainNumeroFacture","numero","toString","padStart","createFacture","post","_clearCache","factureId","message","Error","updateFacture","put","deleteFacture","delete","changerEtatFacture","nouvelEtat","requestData","annulerFacture","envoyerFactureParEmail","emailData","processedResponse","shouldOpenNewWindow","etatMisAJour","method","requestId","newWindowUrl","enregistrerPaiement","data","idPaiement","numeroPaiement","getHistoriquePaiements","paiements","supprimerPaiement","getFactureUrl","pdfUrl","trim","finalUrl","startsWith","imprimerFacture","options","etatActuel","finalPdfUrl","getStatistiques","statistiques","_default","exports"],"sources":["FactureService.js"],"sourcesContent":["/**\r\n * Service de gestion des factures - VERSION FINALE sans √©tat \"Retard\" persist√©\r\n * @class FactureService\r\n * @description G√®re l'acc√®s aux donn√©es des factures via l'API facture-api.php\r\n */\r\nimport api from './api';\r\nimport { backendUrl } from '../utils/urlHelper';\r\nimport { toBoolean, normalizeBooleanFields, normalizeBooleanFieldsArray } from '../utils/booleanHelper';\r\nimport ParametreService from './ParametreService';\r\nimport { formatMontant } from '../utils/formatters';\r\nimport { handleApiError } from '../utils/apiErrorHandler';\r\nimport { createLogger } from '../utils/createLogger';\r\n\r\n\r\nclass FactureService {\r\n  constructor() {\r\n    this.factures = [];\r\n    this._cacheFacture = {};\r\n    this._parametreService = new ParametreService();\r\n    this._delaiPaiementCache = null;\r\n\r\n    this.log = createLogger('FactureService');\r\n  }\r\n\r\n  /**\r\n   * R√©cup√®re le d√©lai de paiement depuis les param√®tres\r\n   * @returns {Promise<number>} - D√©lai en jours\r\n   */\r\n  async _getDelaiPaiement() {\r\n    try {\r\n      if (this._delaiPaiementCache !== null) {\r\n        return this._delaiPaiementCache;\r\n      }\r\n\r\n      const result = await this._parametreService.getParametre(\r\n        'Delai Paiement',\r\n        'Facture',\r\n        'Paiement'\r\n      );\r\n\r\n      if (result.success && result.parametre) {\r\n        this._delaiPaiementCache = parseInt(result.parametre.valeurParametre) || 30;\r\n        this.log.debug('‚úÖ D√©lai de paiement r√©cup√©r√©:', this._delaiPaiementCache, 'jours');\r\n      } else {\r\n        this.log.warn('‚ö†Ô∏è Param√®tre \"Delai Paiement\" non trouv√©, utilisation de la valeur par d√©faut (30 jours)');\r\n        this._delaiPaiementCache = 30;\r\n      }\r\n\r\n      return this._delaiPaiementCache;\r\n    } catch (error) {\r\n      handleApiError(error, `_getDelaiPaiement`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * D√©termine l'√©tat d'une facture (sans gestion de \"Retard\" persist√©)\r\n   * @param {Object} facture - Donn√©es de la facture\r\n   * @returns {string} - √âtat de base stock√© en base\r\n   */\r\n  _determinerEtatBase(facture) {\r\n    // Priorit√© aux √©tats explicites (sauf \"Retard\" qui ne doit plus √™tre persist√©)\r\n    if (facture.etat && facture.etat !== 'Retard') {\r\n      return facture.etat;\r\n    }\r\n    \r\n    // Logique de d√©duction bas√©e sur les donn√©es\r\n    if (facture.date_paiement) {\r\n      return 'Pay√©e';\r\n    } else if (facture.date_annulation) {\r\n      return 'Annul√©e';\r\n    } else {\r\n      return toBoolean(facture.est_imprimee) ? '√âdit√©e' : 'En attente';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * D√©termine l'√©tat d'affichage d'une facture (avec calcul dynamique de retard)\r\n   * @param {Object} facture - Donn√©es de la facture\r\n   * @returns {Promise<string>} - √âtat pour l'interface utilisateur\r\n   */\r\n  async _determinerEtatAffichage(facture) {\r\n    const etatBase = this._determinerEtatBase(facture);\r\n    \r\n   \r\n    // Si la facture est \"Envoy√©e\" et pas encore pay√©e, v√©rifier le retard\r\n    if (etatBase === 'Envoy√©e' && !facture.date_paiement && await this._estEnRetard(facture)) {\r\n      return 'Retard';\r\n    }\r\n    \r\n    return etatBase;\r\n  }\r\n\r\n  /**\r\n   * V√©rifie si une facture est en retard de paiement\r\n   * @param {Object} facture - Donn√©es de la facture\r\n   * @returns {Promise<boolean>} - True si en retard\r\n   */\r\n  async _estEnRetard(facture) {\r\n    if (!facture.date_facture || facture.date_paiement || facture.date_annulation) {\r\n      this.log.debug(`üìÖ Facture ${facture.numeroFacture || facture.id} - Pas de retard: date_facture=${facture.date_facture}, date_paiement=${facture.date_paiement}, date_annulation=${facture.date_annulation}`);\r\n      return false;\r\n    }\r\n    \r\n    const dateFacture = new Date(facture.date_facture);\r\n    const aujourdhui = new Date();\r\n    const diffTemps = aujourdhui.getTime() - dateFacture.getTime();\r\n    const diffJours = Math.ceil(diffTemps / (1000 * 3600 * 24));\r\n    \r\n    const delaiPaiement = await this._getDelaiPaiement();\r\n    \r\n    const estEnRetard = diffJours > delaiPaiement;\r\n    \r\n    this.log.debug(`üìÖ V√©rification retard - Facture: ${facture.numeroFacture || facture.id}, √Çge: ${diffJours} jours, D√©lai: ${delaiPaiement} jours, En retard: ${estEnRetard}`);\r\n    \r\n    return estEnRetard;\r\n  }\r\n\r\n  /**\r\n   * V√©rifie si une facture peut recevoir des paiements\r\n   * @param {Object} facture - Donn√©es de la facture\r\n   * @returns {Promise<boolean>} - True si payable\r\n   */\r\n  async _peutRecevoirPaiement(facture) {\r\n    const etatAffichage = await this._determinerEtatAffichage(facture);\r\n    const etatsPayables = ['Envoy√©e', 'Retard', 'Partiellement pay√©e'];\r\n    return etatsPayables.includes(etatAffichage);\r\n  }\r\n\r\n  /**\r\n   * Version simplifi√©e pour la compatibilit√© (calcul dynamique uniquement)\r\n   * @param {Object} facture - Donn√©es de la facture\r\n   * @returns {string} - √âtat calcul√© dynamiquement\r\n   */\r\n  _determinerEtatFacture(facture) {\r\n    const etatBase = this._determinerEtatBase(facture);\r\n    \r\n    // Pour la version synchrone, on ne peut pas faire le calcul de retard dynamique\r\n    // On retourne l'√©tat de base, le calcul de retard se fera via _determinerEtatAffichage\r\n    return etatBase;\r\n  }\r\n\r\n  /**\r\n   * Vide le cache du d√©lai de paiement\r\n   */\r\n  _clearDelaiPaiementCache() {\r\n    this._delaiPaiementCache = null;\r\n  }\r\n\r\n  /**\r\n   * R√©cup√®re les factures payables avec d√©lai configurable\r\n   * @param {number} annee - Ann√©e √† filtrer\r\n   * @returns {Promise<Array>} - Liste des factures pouvant recevoir des paiements\r\n   */\r\n  async getFacturesPayables(annee = null) {\r\n    try {\r\n      const factures = await this.chargerFactures(annee);\r\n      \r\n      const facturesPayables = [];\r\n      \r\n      for (const facture of factures) {\r\n        if (await this._peutRecevoirPaiement(facture)) {\r\n          // Enrichir avec l'√©tat d'affichage correct (avec calcul de retard)\r\n          facture.etatAffichage = await this._determinerEtatAffichage(facture);\r\n          facturesPayables.push(facture);\r\n        }\r\n      }\r\n      \r\n      return facturesPayables;\r\n    } catch (error) {\r\n      handleApiError(error, `getFacturesPayables`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enrichit une facture avec son √©tat d'affichage calcul√© dynamiquement\r\n   * @param {Object} facture - Facture √† enrichir\r\n   * @returns {Promise<Object>} - Facture avec etatAffichage\r\n   */\r\n  async enrichirAvecEtatAffichage(facture) {\r\n    const factureEnrichie = { ...facture };\r\n    factureEnrichie.etatAffichage = await this._determinerEtatAffichage(facture);\r\n    return factureEnrichie;\r\n  }\r\n\r\n  /**\r\n   * Enrichit un tableau de factures avec les √©tats d'affichage calcul√©s\r\n   * @param {Array} factures - Tableau de factures √† enrichir\r\n   * @returns {Promise<Array>} - Factures avec etatAffichage\r\n   */\r\n  async enrichirFacturesAvecEtatAffichage(factures) {\r\n    const facturesEnrichies = [];\r\n    \r\n    for (const facture of factures) {\r\n      const factureEnrichie = await this.enrichirAvecEtatAffichage(facture);\r\n      facturesEnrichies.push(factureEnrichie);\r\n    }\r\n    \r\n    return facturesEnrichies;\r\n  }\r\n\r\n  /**\r\n   * Normalisation d'une facture\r\n   * @param {Object} facture - Facture √† normaliser\r\n   * @returns {Object} - Facture avec propri√©t√©s bool√©ennes normalis√©es\r\n   */\r\n  normalizeFacture(facture) {\r\n    if (!facture || typeof facture !== 'object') return facture;\r\n    \r\n    const booleanFields = ['est_imprimee', 'est_envoyee', 'est_annulee', 'est_payee'];\r\n    return normalizeBooleanFields(facture, booleanFields);\r\n  }\r\n\r\n  /**\r\n   * Normalisation d'un tableau de factures\r\n   * @param {Array} factures - Tableau de factures √† normaliser\r\n   * @returns {Array} - Factures avec propri√©t√©s bool√©ennes normalis√©es\r\n   */\r\n  normalizeFactures(factures) {\r\n    if (!Array.isArray(factures)) return factures;\r\n    \r\n    const booleanFields = ['est_imprimee', 'est_envoyee', 'est_annulee', 'est_payee'];\r\n    return normalizeBooleanFieldsArray(factures, booleanFields);\r\n  }\r\n\r\n  async chargerFactures(annee = null) {\r\n    try {\r\n      const params = {};\r\n      if (annee) {\r\n        params.annee = annee;\r\n      }\r\n\r\n      this.log.debug('FactureService - Chargement des factures pour l\\'ann√©e:', annee);\r\n      const response = await api.get('facture-api.php', params);\r\n      this.log.debug('FactureService - R√©ponse de l\\'API get:', response);\r\n      \r\n      if (response && response.success) {\r\n        const facturesData = response.factures || [];\r\n\r\n        // Normalisation pr√©ventive des bool√©ens\r\n        const facturesNormalisees = this.normalizeFactures(facturesData);\r\n\r\n        const facturesTriees = facturesNormalisees.sort((a, b) => {\r\n          const numA = a.numeroFacture ? parseInt(a.numeroFacture.split('.')[0]) : 0;\r\n          const numB = b.numeroFacture ? parseInt(b.numeroFacture.split('.')[0]) : 0;\r\n          return numB - numA;\r\n        });\r\n        \r\n        // Adaptation des donn√©es avec √©tat de base\r\n        const facturesAdaptees = facturesTriees.map(facture => ({\r\n          idFacture: facture.idFacture,\r\n          numeroFacture: facture.numeroFacture,\r\n          client: {\r\n            idClient: facture.idClient,\r\n            prenom: facture.prenom,\r\n            nom: facture.nom,\r\n            email: facture.email || null\r\n          },\r\n          montantTotal: parseFloat(facture.montantTotal),\r\n          etat: this._determinerEtatFacture(facture), // √âtat de base uniquement\r\n          date_facture: facture.dateFacture,\r\n          dateFacture: facture.dateFacture,\r\n          date_paiement: facture.datePaiement,\r\n          date_annulation: facture.dateAnnulation,\r\n          // Propri√©t√©s bool√©ennes normalis√©es\r\n          est_imprimee: toBoolean(facture.est_imprimee),\r\n          est_envoyee: toBoolean(facture.est_envoyee),\r\n          est_annulee: toBoolean(facture.est_annulee),\r\n          est_payee: toBoolean(facture.est_payee)\r\n        }));\r\n        \r\n        // ‚úÖ ENRICHISSEMENT AUTOMATIQUE avec √©tat d'affichage calcul√© dynamiquement\r\n        const facturesEnrichies = [];\r\n        for (const facture of facturesAdaptees) {\r\n          const etatAffichage = await this._determinerEtatAffichage(facture);\r\n          facturesEnrichies.push({\r\n            ...facture,\r\n            etatAffichage: etatAffichage\r\n          });\r\n        }\r\n        \r\n        this.factures = facturesEnrichies;\r\n        return facturesEnrichies;\r\n      }\r\n      return [];\r\n    } catch (error) {\r\n      handleApiError(error, `chargerFactures`);\r\n    }\r\n  }\r\n\r\n  async getFacture(id) {\r\n    try {\r\n      this.log.debug('R√©cup√©ration de la facture:', id);\r\n      if (id in this._cacheFacture) {\r\n          this.log.debug('Facture trouv√©e dans le cache:', id);\r\n          // ‚úÖ Enrichir la facture du cache avec l'√©tat d'affichage actuel\r\n          const factureCache = this._cacheFacture[id];\r\n          factureCache.etatAffichage = await this._determinerEtatAffichage(factureCache);\r\n          return factureCache;\r\n      }\r\n      \r\n      const response = await api.get(`facture-api.php?id=${id}`);\r\n      this.log.debug('R√©ponse de l\\'API:', response);\r\n      \r\n      if (response && response.success && response.facture) {\r\n          const factureData = response.facture;\r\n          \r\n          // ‚úÖ AJOUT: Debug des donn√©es brutes de l'API\r\n          this.log.debug('üîç Donn√©es brutes de l\\'API facture:', factureData);\r\n          this.log.debug('üîç Cl√©s disponibles dans factureData:', Object.keys(factureData));\r\n          this.log.debug('üîç Valeurs importantes:', {\r\n            idFacture: factureData.idFacture,\r\n            numeroFacture: factureData.numeroFacture,\r\n            dateFacture: factureData.dateFacture,\r\n            idClient: factureData.idClient,\r\n            montant_total: factureData.montant_total,\r\n            prenom: factureData.prenom,\r\n            nom: factureData.nom\r\n          });\r\n          \r\n          // Normalisation pr√©ventive des bool√©ens\r\n          const factureNormalisee = this.normalizeFacture(factureData);\r\n          \r\n          // Gestion du chemin du document avec URL correcte\r\n          let documentPath = null;\r\n          if (factureNormalisee.factfilename) {\r\n              try {\r\n                  const outputDirResponse = await api.get('parametre-api.php?nomParametre=OutputDir&groupe=Facture&sGroupe=Chemin');\r\n                  \r\n                  let outputDir = 'storage/factures';\r\n                  if (outputDirResponse && outputDirResponse.success) {\r\n                      outputDir = outputDirResponse.parametre?.valeurParametre || outputDir;\r\n                  }\r\n                  \r\n                  documentPath = backendUrl(`${outputDir}/${factureNormalisee.factfilename}`);\r\n                  this.log.debug('Chemin du document de facture:', documentPath);\r\n              } catch (e) {\r\n                  this.log.warn('Erreur lors de la r√©cup√©ration du chemin du document:', e);\r\n              }\r\n          }\r\n\r\n          this.log.debug('üîç Donn√©es normalis√©es de la facture:', factureNormalisee);\r\n\r\n          const factureFormattee = {\r\n              // ‚úÖ CORRECTION: Essayer diff√©rentes variantes de noms de champs\r\n              idFacture: factureNormalisee.idFacture || factureNormalisee.id_facture || '',\r\n              numeroFacture: factureNormalisee.numeroFacture || factureNormalisee.numero_facture || '',\r\n              dateFacture: factureNormalisee.dateFacture || factureNormalisee.date_facture || '',\r\n              idClient: factureNormalisee.idClient,\r\n              montantTotal: parseFloat(factureNormalisee.montantTotal || 0),\r\n              ristourne: parseFloat(factureNormalisee.ristourne || 0),\r\n              montantBrut: parseFloat(factureNormalisee.montantBrut || 0),\r\n              totalAvecRistourne: parseFloat(factureNormalisee.montantTotal || 0) - parseFloat(factureNormalisee.ristourne || 0),\r\n              \r\n              // Donn√©es des paiements multiples\r\n              montantPayeTotal: parseFloat(factureNormalisee.montantPayeTotal || 0),\r\n              montantRestant: parseFloat(factureNormalisee.montantRestant || 0),\r\n              nbPaiements: parseInt(factureNormalisee.nbPaiements || 0),\r\n              dateDernierPaiement: factureNormalisee.dateDernierPaiement || null,\r\n              \r\n              lignes: (factureNormalisee.lignes || []).map(ligne => ({\r\n                  idLigne: ligne.idLigne,\r\n                  description: ligne.description,\r\n                  // unite: ligne.unite,\r\n                  quantite: parseFloat(ligne.quantite || 0),\r\n                  prixUnitaire: parseFloat(ligne.prixUnitaire || 0),\r\n                  totalLigne: parseFloat(ligne.totalLigne || 0),\r\n                  idService: ligne.idService || null,\r\n                  idUnite: ligne.idUnite || null,\r\n                  // serviceType: ligne.service_type || ligne.serviceType || null,\r\n                  noOrdre: ligne.noOrdre || null,\r\n                  descriptionDates: ligne.descriptionDates || null\r\n              })),\r\n              etat: this._determinerEtatBase(factureNormalisee), // √âtat de base uniquement\r\n              documentPath: documentPath,\r\n              factfilename: factureNormalisee.factfilename || null,\r\n              date_annulation: factureNormalisee.date_annulation || null,\r\n              date_paiement: factureNormalisee.date_paiement || null,\r\n              \r\n              // Propri√©t√©s bool√©ennes normalis√©es\r\n              est_imprimee: toBoolean(factureNormalisee.est_imprimee),\r\n              est_envoyee: toBoolean(factureNormalisee.est_envoyee),\r\n              est_annulee: toBoolean(factureNormalisee.est_annulee),\r\n              est_payee: toBoolean(factureNormalisee.est_payee),\r\n              client: factureNormalisee.nom ? {\r\n                  id: factureNormalisee.idClient,\r\n                  prenom: factureNormalisee.prenom,\r\n                  nom: factureNormalisee.nom,\r\n                  email: factureNormalisee.email || null,\r\n              } : null\r\n          };\r\n          \r\n          // ‚úÖ AJOUT: Debug des donn√©es format√©es\r\n          this.log.debug('üîç Donn√©es format√©es pour le frontend:', factureFormattee);\r\n          \r\n          // ‚úÖ ENRICHISSEMENT AUTOMATIQUE avec √©tat d'affichage calcul√© dynamiquement\r\n          factureFormattee.etatAffichage = await this._determinerEtatAffichage(factureFormattee);\r\n          \r\n          this.log.debug(`üîç Facture ${factureFormattee.numeroFacture} - √âtat de base: ${factureFormattee.etat}, √âtat d'affichage: ${factureFormattee.etatAffichage}`);\r\n          \r\n          this._cacheFacture[id] = factureFormattee;\r\n          return factureFormattee;\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      handleApiError(error, `getFacture(${id})`);\r\n    }\r\n  }\r\n\r\n  async getProchainNumeroFacture(annee) {\r\n    try {\r\n      const response = await api.get(`facture-api.php?prochainNumeroFacture=${annee}`);\r\n      \r\n      if (response && response.success && response.parametre) {\r\n        const numero = response.parametre.valeurParametre \r\n          ? `${response.parametre.valeurParametre.toString().padStart(3, '0')}.${annee}`\r\n          : `001.${annee}`;\r\n        \r\n        return numero;\r\n      }\r\n      \r\n      return `001.${annee}`;\r\n    } catch (error) {\r\n      handleApiError(error, `getProchainNumeroFacture(${annee})`);\r\n    }\r\n  }\r\n\r\n  async createFacture(factureData) {\r\n    this.log.debug('FactureService - createFacture - Cr√©ation de la facture avec les donn√©es:', factureData);\r\n    try {\r\n      const response = await api.post('facture-api.php', factureData);\r\n      this.log.debug('FactureService - createFacture - response', response)\r\n      \r\n      if (response && response.success) {\r\n        this._clearCache();\r\n        return {\r\n          success: true,\r\n          id: response.factureId,\r\n          message: response.message || 'Facture cr√©√©e avec succ√®s'\r\n        };\r\n      } else {\r\n        throw new Error(response?.message || 'Erreur lors de la cr√©ation de la facture');\r\n      }\r\n    } catch (error) {\r\n      handleApiError(error, `createFacture`);\r\n    }\r\n  }\r\n\r\n  async updateFacture(id, factureData) {\r\n    try {\r\n      this.log.debug(`FactureService - updateFacture - Mise √† jour de la facture ${id} avec les donn√©es:`, factureData);\r\n      const response = await api.put(`facture-api.php?id=${id}`, factureData);\r\n      this.log.debug(`FactureService - updateFacture - R√©ponse de l'API:`, response);\r\n\r\n      if (response && response.success) {\r\n        delete this._cacheFacture[id];\r\n        return {\r\n          success: true,\r\n          message: response.message || 'Facture modifi√©e avec succ√®s'\r\n        };\r\n      } else {\r\n        throw new Error(response?.message || 'Erreur lors de la modification de la facture');\r\n      }\r\n    } catch (error) {\r\n      handleApiError(error, `updateFacture(${id})`);\r\n    }\r\n  }\r\n\r\n  async deleteFacture(id) {\r\n    try {\r\n      const response = await api.delete(`facture-api.php?id=${id}`);\r\n      \r\n      if (response && response.success) {\r\n        delete this._cacheFacture[id];\r\n        return {\r\n          success: true,\r\n          message: response.message || 'Facture supprim√©e avec succ√®s'\r\n        };\r\n      } else {\r\n        throw new Error(response?.message || 'Erreur lors de la suppression de la facture');\r\n      }\r\n    } catch (error) {\r\n      handleApiError(error, `deleteFacture(${id})`);\r\n    }\r\n  }\r\n\r\n  async changerEtatFacture(id, nouvelEtat) {\r\n    try {\r\n      // Emp√™cher la persistance de l'√©tat \"Retard\"\r\n      if (nouvelEtat === 'Retard') {\r\n        this.log.warn('‚ö†Ô∏è Tentative de persistance de l\\'√©tat \"Retard\" bloqu√©e. Cet √©tat est calcul√© dynamiquement.');\r\n        return {\r\n          success: false,\r\n          message: 'L\\'√©tat \"Retard\" ne peut pas √™tre persist√©, il est calcul√© automatiquement.'\r\n        };\r\n      }\r\n\r\n      const requestData = {\r\n        nouvelEtat: nouvelEtat\r\n      };\r\n\r\n      const response = await api.post(`facture-api.php?changerEtat&id=${id}`, requestData);\r\n      \r\n      if (response && response.success) {\r\n        delete this._cacheFacture[id];\r\n        return {\r\n          success: true,\r\n          message: response.message || `Facture mise √† jour avec l'√©tat \"${nouvelEtat}\" avec succ√®s`\r\n        };\r\n      } else {\r\n        throw new Error(response?.message || `Erreur lors du changement d'√©tat de la facture √† \"${nouvelEtat}\"`);\r\n      }\r\n    } catch (error) {\r\n      handleApiError(error, `changerEtatFacture(${id})`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Annule une facture en changeant son √©tat √† \"Annul√©e\"\r\n   * @param {number} id - ID de la facture √† annuler\r\n   * @returns {Promise<Object>} - R√©sultat de l'op√©ration\r\n   */\r\n  async annulerFacture(id) {\r\n    try {\r\n      this.log.debug(`üö´ Annulation de la facture ${id}`);\r\n      return await this.changerEtatFacture(id, 'Annul√©e');\r\n    } catch (error) {\r\n      handleApiError(error, `annulerFacture(${id})`);\r\n    }\r\n  }\r\n\r\n  async envoyerFactureParEmail(idFacture, emailData) {\r\n    try {\r\n        const response = await api.post(`facture-api.php?envoyer&id=${idFacture}`, emailData);\r\n        \r\n        this.log.debug('R√©ponse de l\\'API pour l\\'envoi par email:', response);\r\n        \r\n        if (response && response.success) {\r\n            let processedResponse = { ...response };\r\n            \r\n            // Normalisation des bool√©ens dans la r√©ponse\r\n            processedResponse.shouldOpenNewWindow = toBoolean(response.shouldOpenNewWindow);\r\n            processedResponse.etatMisAJour = toBoolean(response.etatMisAJour);\r\n            \r\n            return {\r\n                success: true,\r\n                message: response.message || 'Facture envoy√©e par email avec succ√®s',\r\n                method: response.method,\r\n                requestId: response.requestId,\r\n                shouldOpenNewWindow: processedResponse.shouldOpenNewWindow,\r\n                newWindowUrl: processedResponse.newWindowUrl,\r\n                etatMisAJour: processedResponse.etatMisAJour,\r\n                ...processedResponse\r\n            };\r\n        } else {\r\n            throw new Error(response?.message || 'Erreur lors de l\\'envoi de la facture par email');\r\n        }\r\n    } catch (error) {\r\n        handleApiError(error, `envoyerFactureParMail(${idFacture})`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enregistre un paiement avec le nouveau syst√®me de paiements multiples\r\n   */\r\n  async enregistrerPaiement(id, data) {\r\n      try {\r\n          const response = await api.post(`facture-api.php?paiement&id=${id}`, data);\r\n          \r\n          if (response && response.success) {\r\n              delete this._cacheFacture[id];\r\n              return {\r\n                  success: true,\r\n                  message: response.message || 'Paiement enregistr√© avec succ√®s',\r\n                  idPaiement: response.idPaiement,\r\n                  numeroPaiement: response.numeroPaiement\r\n              };\r\n          } else {\r\n              throw new Error(response?.message || 'Erreur lors de l\\'enregistrement du paiement');\r\n          }\r\n      } catch (error) {\r\n          handleApiError(error, `enregistrerPaiement(${id})`);\r\n      }\r\n  }\r\n\r\n  /**\r\n   * R√©cup√®re l'historique des paiements d'une facture\r\n   */\r\n  async getHistoriquePaiements(idFacture) {\r\n      try {\r\n          const response = await api.get(`facture-api.php?historiquePaiements&id=${idFacture}`);\r\n          \r\n          if (response && response.success) {\r\n              return {\r\n                  success: true,\r\n                  paiements: response.paiements || []\r\n              };\r\n          } else {\r\n              throw new Error(response?.message || 'Erreur lors de la r√©cup√©ration de l\\'historique');\r\n          }\r\n      } catch (error) {\r\n          handleApiError(error, `getHistoriquePaiements(${idFacture})`);\r\n      }\r\n  }\r\n\r\n  /**\r\n   * Supprime un paiement (annulation)\r\n   */\r\n  async supprimerPaiement(idPaiement) {\r\n      try {\r\n          const response = await api.delete(`facture-api.php?supprimerPaiement&id=${idPaiement}`);\r\n          \r\n          if (response && response.success) {\r\n              if (response.idFacture) {\r\n                  delete this._cacheFacture[response.idFacture];\r\n              }\r\n              \r\n              return {\r\n                  success: true,\r\n                  message: response.message || 'Paiement supprim√© avec succ√®s',\r\n                  idFacture: response.idFacture\r\n              };\r\n          } else {\r\n              throw new Error(response?.message || 'Erreur lors de la suppression du paiement');\r\n          }\r\n      } catch (error) {\r\n          handleApiError(error, `supprimerPaiement(${idPaiement})`);\r\n      }\r\n  }\r\n\r\n  async getFactureUrl(id) {\r\n    try {\r\n        if (id in this._cacheFacture && this._cacheFacture[id].documentPath) {\r\n            return {\r\n                success: true,\r\n                pdfUrl: this._cacheFacture[id].documentPath\r\n            };\r\n        }\r\n        \r\n        const facture = await this.getFacture(id);\r\n        \r\n        if (facture && facture.documentPath) {\r\n            return {\r\n                success: true,\r\n                pdfUrl: facture.documentPath\r\n            };\r\n        }\r\n        \r\n        if (facture && facture.factfilename && facture.factfilename.trim() !== '') {\r\n            const response = await api.get(`facture-api.php?getUrl=1&id=${id}`);\r\n            \r\n            if (response && response.success && response.pdfUrl) {\r\n                let finalUrl = response.pdfUrl;\r\n                if (!finalUrl.startsWith('http')) {\r\n                    finalUrl = backendUrl(finalUrl);\r\n                }\r\n                \r\n                return {\r\n                    success: true,\r\n                    pdfUrl: finalUrl\r\n                };\r\n            }\r\n        }\r\n        \r\n        return {\r\n            success: false,\r\n            message: 'Aucun fichier PDF associ√© √† cette facture'\r\n        };\r\n    } catch (error) {\r\n        handleApiError(error, `getFactureUrl(${id})`);\r\n    }\r\n  }\r\n\r\n  async imprimerFacture(id, options = {}) {\r\n    try {\r\n      this.log.debug(`Impression de la facture ${id} avec options:`, options);\r\n      const response = await api.post(`facture-api.php?imprimer=1&id=${id}`, { options });\r\n      this.log.debug(`R√©ponse de l'impression de la facture ${id}:`, response);\r\n\r\n      if (response && response.success) {\r\n        delete this._cacheFacture[id];\r\n\r\n        if (response.etatActuel === 'En attente') {\r\n          await this.changerEtatFacture(id, '√âdit√©e');\r\n        }\r\n\r\n        let finalPdfUrl = response.pdfUrl;\r\n        if (finalPdfUrl && !finalPdfUrl.startsWith('http')) {\r\n            finalPdfUrl = backendUrl(finalPdfUrl);\r\n        }\r\n\r\n        return {\r\n          success: true,\r\n          pdfUrl: finalPdfUrl,\r\n          message: response.message || 'Facture imprim√©e avec succ√®s'\r\n        };\r\n      } else {\r\n        throw new Error(response?.message || 'Erreur lors de l\\'impression de la facture');\r\n      }\r\n    } catch (error) {\r\n      handleApiError(error, `imprimerFacture(${id})`);\r\n    }\r\n  }\r\n\r\n  async getStatistiques(annee = null) {\r\n    try {\r\n      const params = {\r\n        statistiques: true\r\n      };\r\n      \r\n      if (annee) {\r\n        params.annee = annee;\r\n      }\r\n\r\n      const response = await api.get('facture-api.php', params);\r\n      this.log.debug(\"getStatistiques Reponse :\", response);\r\n      \r\n      if (response && response.success) {\r\n        return {\r\n          success: true,\r\n          statistiques: response.statistiques || {}\r\n        };\r\n      } else {\r\n        throw new Error(response?.message || 'Erreur lors de la r√©cup√©ration des statistiques');\r\n      }\r\n    } catch (error) {\r\n      handleApiError(error, `getStatistiques`);\r\n    }\r\n  }\r\n\r\n  _clearCache() {\r\n    this._cacheFacture = {};\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default FactureService;"],"mappings":"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","ignoreList":[]}
8589a2b1ff5fc82bbe57c0c1057a4c86
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _utils = _interopRequireDefault(require("../utils.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * It takes a string like `foo[x][y][z]` and returns an array like `['foo', 'x', 'y', 'z']
 *
 * @param {string} name - The name of the property to get.
 *
 * @returns An array of strings.
 */
function parsePropPath(name) {
  // foo[x][y][z]
  // foo.x.y.z
  // foo-x-y-z
  // foo x y z
  return _utils.default.matchAll(/\w+|\[(\w*)]/g, name).map(match => {
    return match[0] === '[]' ? '' : match[1] || match[0];
  });
}

/**
 * Convert an array to an object.
 *
 * @param {Array<any>} arr - The array to convert to an object.
 *
 * @returns An object with the same keys and values as the array.
 */
function arrayToObject(arr) {
  const obj = {};
  const keys = Object.keys(arr);
  let i;
  const len = keys.length;
  let key;
  for (i = 0; i < len; i++) {
    key = keys[i];
    obj[key] = arr[key];
  }
  return obj;
}

/**
 * It takes a FormData object and returns a JavaScript object
 *
 * @param {string} formData The FormData object to convert to JSON.
 *
 * @returns {Object<string, any> | null} The converted object.
 */
function formDataToJSON(formData) {
  function buildPath(path, value, target, index) {
    let name = path[index++];
    if (name === '__proto__') return true;
    const isNumericKey = Number.isFinite(+name);
    const isLast = index >= path.length;
    name = !name && _utils.default.isArray(target) ? target.length : name;
    if (isLast) {
      if (_utils.default.hasOwnProp(target, name)) {
        target[name] = [target[name], value];
      } else {
        target[name] = value;
      }
      return !isNumericKey;
    }
    if (!target[name] || !_utils.default.isObject(target[name])) {
      target[name] = [];
    }
    const result = buildPath(path, value, target[name], index);
    if (result && _utils.default.isArray(target[name])) {
      target[name] = arrayToObject(target[name]);
    }
    return !isNumericKey;
  }
  if (_utils.default.isFormData(formData) && _utils.default.isFunction(formData.entries)) {
    const obj = {};
    _utils.default.forEachEntry(formData, (name, value) => {
      buildPath(parsePropPath(name), value, obj, 0);
    });
    return obj;
  }
  return null;
}
var _default = exports.default = formDataToJSON;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfdXRpbHMiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImUiLCJfX2VzTW9kdWxlIiwicGFyc2VQcm9wUGF0aCIsIm5hbWUiLCJ1dGlscyIsIm1hdGNoQWxsIiwibWFwIiwibWF0Y2giLCJhcnJheVRvT2JqZWN0IiwiYXJyIiwib2JqIiwia2V5cyIsImkiLCJsZW4iLCJsZW5ndGgiLCJrZXkiLCJmb3JtRGF0YVRvSlNPTiIsImZvcm1EYXRhIiwiYnVpbGRQYXRoIiwicGF0aCIsInRhcmdldCIsImluZGV4IiwiaXNOdW1lcmljS2V5IiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJpc0xhc3QiLCJpc0FycmF5IiwiaGFzT3duUHJvcCIsImlzT2JqZWN0IiwicmVzdWx0IiwiaXNGb3JtRGF0YSIsImlzRnVuY3Rpb24iLCJlbnRyaWVzIiwiZm9yRWFjaEVudHJ5IiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyJmb3JtRGF0YVRvSlNPTi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCB1dGlscyBmcm9tICcuLi91dGlscy5qcyc7XG5cbi8qKlxuICogSXQgdGFrZXMgYSBzdHJpbmcgbGlrZSBgZm9vW3hdW3ldW3pdYCBhbmQgcmV0dXJucyBhbiBhcnJheSBsaWtlIGBbJ2ZvbycsICd4JywgJ3knLCAneiddXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICpcbiAqIEByZXR1cm5zIEFuIGFycmF5IG9mIHN0cmluZ3MuXG4gKi9cbmZ1bmN0aW9uIHBhcnNlUHJvcFBhdGgobmFtZSkge1xuICAvLyBmb29beF1beV1bel1cbiAgLy8gZm9vLngueS56XG4gIC8vIGZvby14LXktelxuICAvLyBmb28geCB5IHpcbiAgcmV0dXJuIHV0aWxzLm1hdGNoQWxsKC9cXHcrfFxcWyhcXHcqKV0vZywgbmFtZSkubWFwKG1hdGNoID0+IHtcbiAgICByZXR1cm4gbWF0Y2hbMF0gPT09ICdbXScgPyAnJyA6IG1hdGNoWzFdIHx8IG1hdGNoWzBdO1xuICB9KTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0IGFuIGFycmF5IHRvIGFuIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge0FycmF5PGFueT59IGFyciAtIFRoZSBhcnJheSB0byBjb252ZXJ0IHRvIGFuIG9iamVjdC5cbiAqXG4gKiBAcmV0dXJucyBBbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBrZXlzIGFuZCB2YWx1ZXMgYXMgdGhlIGFycmF5LlxuICovXG5mdW5jdGlvbiBhcnJheVRvT2JqZWN0KGFycikge1xuICBjb25zdCBvYmogPSB7fTtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGFycik7XG4gIGxldCBpO1xuICBjb25zdCBsZW4gPSBrZXlzLmxlbmd0aDtcbiAgbGV0IGtleTtcbiAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAga2V5ID0ga2V5c1tpXTtcbiAgICBvYmpba2V5XSA9IGFycltrZXldO1xuICB9XG4gIHJldHVybiBvYmo7XG59XG5cbi8qKlxuICogSXQgdGFrZXMgYSBGb3JtRGF0YSBvYmplY3QgYW5kIHJldHVybnMgYSBKYXZhU2NyaXB0IG9iamVjdFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtRGF0YSBUaGUgRm9ybURhdGEgb2JqZWN0IHRvIGNvbnZlcnQgdG8gSlNPTi5cbiAqXG4gKiBAcmV0dXJucyB7T2JqZWN0PHN0cmluZywgYW55PiB8IG51bGx9IFRoZSBjb252ZXJ0ZWQgb2JqZWN0LlxuICovXG5mdW5jdGlvbiBmb3JtRGF0YVRvSlNPTihmb3JtRGF0YSkge1xuICBmdW5jdGlvbiBidWlsZFBhdGgocGF0aCwgdmFsdWUsIHRhcmdldCwgaW5kZXgpIHtcbiAgICBsZXQgbmFtZSA9IHBhdGhbaW5kZXgrK107XG5cbiAgICBpZiAobmFtZSA9PT0gJ19fcHJvdG9fXycpIHJldHVybiB0cnVlO1xuXG4gICAgY29uc3QgaXNOdW1lcmljS2V5ID0gTnVtYmVyLmlzRmluaXRlKCtuYW1lKTtcbiAgICBjb25zdCBpc0xhc3QgPSBpbmRleCA+PSBwYXRoLmxlbmd0aDtcbiAgICBuYW1lID0gIW5hbWUgJiYgdXRpbHMuaXNBcnJheSh0YXJnZXQpID8gdGFyZ2V0Lmxlbmd0aCA6IG5hbWU7XG5cbiAgICBpZiAoaXNMYXN0KSB7XG4gICAgICBpZiAodXRpbHMuaGFzT3duUHJvcCh0YXJnZXQsIG5hbWUpKSB7XG4gICAgICAgIHRhcmdldFtuYW1lXSA9IFt0YXJnZXRbbmFtZV0sIHZhbHVlXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldFtuYW1lXSA9IHZhbHVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gIWlzTnVtZXJpY0tleTtcbiAgICB9XG5cbiAgICBpZiAoIXRhcmdldFtuYW1lXSB8fCAhdXRpbHMuaXNPYmplY3QodGFyZ2V0W25hbWVdKSkge1xuICAgICAgdGFyZ2V0W25hbWVdID0gW107XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYnVpbGRQYXRoKHBhdGgsIHZhbHVlLCB0YXJnZXRbbmFtZV0sIGluZGV4KTtcblxuICAgIGlmIChyZXN1bHQgJiYgdXRpbHMuaXNBcnJheSh0YXJnZXRbbmFtZV0pKSB7XG4gICAgICB0YXJnZXRbbmFtZV0gPSBhcnJheVRvT2JqZWN0KHRhcmdldFtuYW1lXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuICFpc051bWVyaWNLZXk7XG4gIH1cblxuICBpZiAodXRpbHMuaXNGb3JtRGF0YShmb3JtRGF0YSkgJiYgdXRpbHMuaXNGdW5jdGlvbihmb3JtRGF0YS5lbnRyaWVzKSkge1xuICAgIGNvbnN0IG9iaiA9IHt9O1xuXG4gICAgdXRpbHMuZm9yRWFjaEVudHJ5KGZvcm1EYXRhLCAobmFtZSwgdmFsdWUpID0+IHtcbiAgICAgIGJ1aWxkUGF0aChwYXJzZVByb3BQYXRoKG5hbWUpLCB2YWx1ZSwgb2JqLCAwKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBvYmo7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZm9ybURhdGFUb0pTT047XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBQUNBLE1BQUEsQ0FBQUMsY0FBQSxDQUFBQyxPQUFBO0VBQUFDLEtBQUE7QUFBQTtBQUFBRCxPQUFBLENBQUFFLE9BQUE7QUFFYixJQUFBQyxNQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFBZ0MsU0FBQUQsdUJBQUFFLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBSixPQUFBLEVBQUFJLENBQUE7QUFFaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTRSxhQUFhQSxDQUFDQyxJQUFJLEVBQUU7RUFDM0I7RUFDQTtFQUNBO0VBQ0E7RUFDQSxPQUFPQyxjQUFLLENBQUNDLFFBQVEsQ0FBQyxlQUFlLEVBQUVGLElBQUksQ0FBQyxDQUFDRyxHQUFHLENBQUNDLEtBQUssSUFBSTtJQUN4RCxPQUFPQSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxHQUFHLEVBQUUsR0FBR0EsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJQSxLQUFLLENBQUMsQ0FBQyxDQUFDO0VBQ3RELENBQUMsQ0FBQztBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU0MsYUFBYUEsQ0FBQ0MsR0FBRyxFQUFFO0VBQzFCLE1BQU1DLEdBQUcsR0FBRyxDQUFDLENBQUM7RUFDZCxNQUFNQyxJQUFJLEdBQUduQixNQUFNLENBQUNtQixJQUFJLENBQUNGLEdBQUcsQ0FBQztFQUM3QixJQUFJRyxDQUFDO0VBQ0wsTUFBTUMsR0FBRyxHQUFHRixJQUFJLENBQUNHLE1BQU07RUFDdkIsSUFBSUMsR0FBRztFQUNQLEtBQUtILENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR0MsR0FBRyxFQUFFRCxDQUFDLEVBQUUsRUFBRTtJ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
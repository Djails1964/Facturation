475c5b0ba30d5b22535d308717a43b65
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = fromDataURI;
var _AxiosError = _interopRequireDefault(require("../core/AxiosError.js"));
var _parseProtocol = _interopRequireDefault(require("./parseProtocol.js"));
var _index = _interopRequireDefault(require("../platform/index.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const DATA_URL_PATTERN = /^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;

/**
 * Parse data uri to a Buffer or Blob
 *
 * @param {String} uri
 * @param {?Boolean} asBlob
 * @param {?Object} options
 * @param {?Function} options.Blob
 *
 * @returns {Buffer|Blob}
 */
function fromDataURI(uri, asBlob, options) {
  const _Blob = options && options.Blob || _index.default.classes.Blob;
  const protocol = (0, _parseProtocol.default)(uri);
  if (asBlob === undefined && _Blob) {
    asBlob = true;
  }
  if (protocol === 'data') {
    uri = protocol.length ? uri.slice(protocol.length + 1) : uri;
    const match = DATA_URL_PATTERN.exec(uri);
    if (!match) {
      throw new _AxiosError.default('Invalid URL', _AxiosError.default.ERR_INVALID_URL);
    }
    const mime = match[1];
    const isBase64 = match[2];
    const body = match[3];
    const buffer = Buffer.from(decodeURIComponent(body), isBase64 ? 'base64' : 'utf8');
    if (asBlob) {
      if (!_Blob) {
        throw new _AxiosError.default('Blob is not supported', _AxiosError.default.ERR_NOT_SUPPORT);
      }
      return new _Blob([buffer], {
        type: mime
      });
    }
    return buffer;
  }
  throw new _AxiosError.default('Unsupported protocol ' + protocol, _AxiosError.default.ERR_NOT_SUPPORT);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJmcm9tRGF0YVVSSSIsIl9BeGlvc0Vycm9yIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfcGFyc2VQcm90b2NvbCIsIl9pbmRleCIsImUiLCJfX2VzTW9kdWxlIiwiREFUQV9VUkxfUEFUVEVSTiIsInVyaSIsImFzQmxvYiIsIm9wdGlvbnMiLCJfQmxvYiIsIkJsb2IiLCJwbGF0Zm9ybSIsImNsYXNzZXMiLCJwcm90b2NvbCIsInBhcnNlUHJvdG9jb2wiLCJ1bmRlZmluZWQiLCJsZW5ndGgiLCJzbGljZSIsIm1hdGNoIiwiZXhlYyIsIkF4aW9zRXJyb3IiLCJFUlJfSU5WQUxJRF9VUkwiLCJtaW1lIiwiaXNCYXNlNjQiLCJib2R5IiwiYnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsImRlY29kZVVSSUNvbXBvbmVudCIsIkVSUl9OT1RfU1VQUE9SVCIsInR5cGUiXSwic291cmNlcyI6WyJmcm9tRGF0YVVSSS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBBeGlvc0Vycm9yIGZyb20gJy4uL2NvcmUvQXhpb3NFcnJvci5qcyc7XG5pbXBvcnQgcGFyc2VQcm90b2NvbCBmcm9tICcuL3BhcnNlUHJvdG9jb2wuanMnO1xuaW1wb3J0IHBsYXRmb3JtIGZyb20gJy4uL3BsYXRmb3JtL2luZGV4LmpzJztcblxuY29uc3QgREFUQV9VUkxfUEFUVEVSTiA9IC9eKD86KFteO10rKTspPyg/OlteO10rOyk/KGJhc2U2NHwpLChbXFxzXFxTXSopJC87XG5cbi8qKlxuICogUGFyc2UgZGF0YSB1cmkgdG8gYSBCdWZmZXIgb3IgQmxvYlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB1cmlcbiAqIEBwYXJhbSB7P0Jvb2xlYW59IGFzQmxvYlxuICogQHBhcmFtIHs/T2JqZWN0fSBvcHRpb25zXG4gKiBAcGFyYW0gez9GdW5jdGlvbn0gb3B0aW9ucy5CbG9iXG4gKlxuICogQHJldHVybnMge0J1ZmZlcnxCbG9ifVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBmcm9tRGF0YVVSSSh1cmksIGFzQmxvYiwgb3B0aW9ucykge1xuICBjb25zdCBfQmxvYiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5CbG9iIHx8IHBsYXRmb3JtLmNsYXNzZXMuQmxvYjtcbiAgY29uc3QgcHJvdG9jb2wgPSBwYXJzZVByb3RvY29sKHVyaSk7XG5cbiAgaWYgKGFzQmxvYiA9PT0gdW5kZWZpbmVkICYmIF9CbG9iKSB7XG4gICAgYXNCbG9iID0gdHJ1ZTtcbiAgfVxuXG4gIGlmIChwcm90b2NvbCA9PT0gJ2RhdGEnKSB7XG4gICAgdXJpID0gcHJvdG9jb2wubGVuZ3RoID8gdXJpLnNsaWNlKHByb3RvY29sLmxlbmd0aCArIDEpIDogdXJpO1xuXG4gICAgY29uc3QgbWF0Y2ggPSBEQVRBX1VSTF9QQVRURVJOLmV4ZWModXJpKTtcblxuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgIHRocm93IG5ldyBBeGlvc0Vycm9yKCdJbnZhbGlkIFVSTCcsIEF4aW9zRXJyb3IuRVJSX0lOVkFMSURfVVJMKTtcbiAgICB9XG5cbiAgICBjb25zdCBtaW1lID0gbWF0Y2hbMV07XG4gICAgY29uc3QgaXNCYXNlNjQgPSBtYXRjaFsyXTtcbiAgICBjb25zdCBib2R5ID0gbWF0Y2hbM107XG4gICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oZGVjb2RlVVJJQ29tcG9uZW50KGJvZHkpLCBpc0Jhc2U2NCA/ICdiYXNlNjQnIDogJ3V0ZjgnKTtcblxuICAgIGlmIChhc0Jsb2IpIHtcbiAgICAgIGlmICghX0Jsb2IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEF4aW9zRXJyb3IoJ0Jsb2IgaXMgbm90IHN1cHBvcnRlZCcsIEF4aW9zRXJyb3IuRVJSX05PVF9TVVBQT1JUKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBfQmxvYihbYnVmZmVyXSwge3R5cGU6IG1pbWV9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYnVmZmVyO1xuICB9XG5cbiAgdGhyb3cgbmV3IEF4aW9zRXJyb3IoJ1Vuc3VwcG9ydGVkIHByb3RvY29sICcgKyBwcm90b2NvbCwgQXhpb3NFcnJvci5FUlJfTk9UX1NVUFBPUlQpO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFDQSxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxPQUFBLEdBQUFDLFdBQUE7QUFFYixJQUFBQyxXQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxjQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxNQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFBNEMsU0FBQUQsdUJBQUFJLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBUCxPQUFBLEVBQUFPLENBQUE7QUFFNUMsTUFBTUUsZ0JBQWdCLEdBQUcsK0NBQStDOztBQUV4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNlLFNBQVNSLFdBQVdBLENBQUNTLEdBQUcsRUFBRUMsTUFBTSxFQUFFQyxPQUFPLEVBQUU7RUFDeEQsTUFBTUMsS0FBSyxHQUFHRCxPQUFPLElBQUlBLE9BQU8sQ0FBQ0UsSUFBSSxJQUFJQyxjQUFRLENBQUNDLE9BQU8sQ0FBQ0YsSUFBSTtFQUM5RCxNQUFNRyxRQUFRLEdBQUcsSUFBQUMsc0JBQWEsRUFBQ1IsR0FBRyxDQUFDO0VBRW5DLElBQUlDLE1BQU0sS0FBS1EsU0FBUyxJQUFJTixLQUFLLEVBQUU7SUFDakNGLE1BQU0sR0FBRyxJQUFJO0VBQ2Y7RUFFQSxJQUFJTSxRQUFRLEtBQUssTUFBTSxFQUFFO0lBQ3ZCUCxHQUFHLEdBQUdPLFFBQVEsQ0FBQ0csTUFBTSxHQUFHVixHQUFHLENBQUNXLEtBQUssQ0FBQ0osUUFBUSxDQUFDRyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUdWLEdBQUc7SUFFNUQsTUFBTVksS0FBSyxHQUFHYixnQkFBZ0IsQ0FBQ2MsSUFBSSxDQUFDYixHQUFHLENBQUM7SUFFeEMsSUFBSSxDQUFDWSxLQUFLLEVBQUU7TUFDVixNQUFNLElBQUlFLG1CQUFVLENBQUMsYUFBYSxFQUFFQSxtQkFBVSxDQUFDQyxlQUFlLENBQUM7SUFDakU7SUFFQSxNQUFNQyxJQUFJLEdBQUdKLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDckIsTUFBTUssUUFBUSxHQUFHTCxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3pCLE1BQU1NLElBQUksR0FBR04sS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNyQixNQUFNTyxNQUFNLEdBQUdDLE1BQU0sQ0FBQ0MsSUFBSSxDQUFDQyxrQkFBa0IsQ0FBQ0osSUFBSSxDQUFDLEVBQUVELFFBQVEsR0FBRyxRQUFRLEdBQUcsTUFBTSxDQUFDO0lBRWxGLElBQUloQixNQUFNLEVBQUU7TUFDVixJQUFJLENBQUNFLEtBQUssRUFBRTtRQUNWLE1BQU0sSUFBSVcsbUJBQVUsQ0FBQyx1QkFBdUIsRUFBRUEsbUJBQVUsQ0FBQ1MsZUFBZSxDQUFDO01BQzNFO01BRUEsT0FBTyxJQUFJcEIsS0FBSyxDQUFDLENBQUNnQixNQUFNLENBQUMsRUFBRTtRQUFDSyxJQUFJLEVBQUVSO01BQUksQ0FBQyxDQUFDO0lBQzFDO0lBRUEsT0FBT0csTUFBTTtFQUNmO0VBRUEsTUFBTSxJQUFJTCxtQkFBVSxDQUFDLHVCQUF1QixHQUFHUCxRQUFRLEVBQUVPLG1CQUFVLENBQUNTLGVBQWUsQ0FBQztBQUN0RiIsImlnbm9yZUxpc3QiOltdfQ==
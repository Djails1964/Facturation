3faebd7268d0f455a99f549723077e1d
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _index = _interopRequireDefault(require("../platform/index.js"));
var _utils = _interopRequireDefault(require("../utils.js"));
var _isURLSameOrigin = _interopRequireDefault(require("./isURLSameOrigin.js"));
var _cookies = _interopRequireDefault(require("./cookies.js"));
var _buildFullPath = _interopRequireDefault(require("../core/buildFullPath.js"));
var _mergeConfig = _interopRequireDefault(require("../core/mergeConfig.js"));
var _AxiosHeaders = _interopRequireDefault(require("../core/AxiosHeaders.js"));
var _buildURL = _interopRequireDefault(require("./buildURL.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
var _default = config => {
  const newConfig = (0, _mergeConfig.default)({}, config);
  let {
    data,
    withXSRFToken,
    xsrfHeaderName,
    xsrfCookieName,
    headers,
    auth
  } = newConfig;
  newConfig.headers = headers = _AxiosHeaders.default.from(headers);
  newConfig.url = (0, _buildURL.default)((0, _buildFullPath.default)(newConfig.baseURL, newConfig.url, newConfig.allowAbsoluteUrls), config.params, config.paramsSerializer);

  // HTTP basic authentication
  if (auth) {
    headers.set('Authorization', 'Basic ' + btoa((auth.username || '') + ':' + (auth.password ? unescape(encodeURIComponent(auth.password)) : '')));
  }
  let contentType;
  if (_utils.default.isFormData(data)) {
    if (_index.default.hasStandardBrowserEnv || _index.default.hasStandardBrowserWebWorkerEnv) {
      headers.setContentType(undefined); // Let the browser set it
    } else if ((contentType = headers.getContentType()) !== false) {
      // fix semicolon duplication issue for ReactNative FormData implementation
      const [type, ...tokens] = contentType ? contentType.split(';').map(token => token.trim()).filter(Boolean) : [];
      headers.setContentType([type || 'multipart/form-data', ...tokens].join('; '));
    }
  }

  // Add xsrf header
  // This is only done if running in a standard browser environment.
  // Specifically not if we're in a web worker, or react-native.

  if (_index.default.hasStandardBrowserEnv) {
    withXSRFToken && _utils.default.isFunction(withXSRFToken) && (withXSRFToken = withXSRFToken(newConfig));
    if (withXSRFToken || withXSRFToken !== false && (0, _isURLSameOrigin.default)(newConfig.url)) {
      // Add xsrf header
      const xsrfValue = xsrfHeaderName && xsrfCookieName && _cookies.default.read(xsrfCookieName);
      if (xsrfValue) {
        headers.set(xsrfHeaderName, xsrfValue);
      }
    }
  }
  return newConfig;
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW5kZXgiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl91dGlscyIsIl9pc1VSTFNhbWVPcmlnaW4iLCJfY29va2llcyIsIl9idWlsZEZ1bGxQYXRoIiwiX21lcmdlQ29uZmlnIiwiX0F4aW9zSGVhZGVycyIsIl9idWlsZFVSTCIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9kZWZhdWx0IiwiY29uZmlnIiwibmV3Q29uZmlnIiwibWVyZ2VDb25maWciLCJkYXRhIiwid2l0aFhTUkZUb2tlbiIsInhzcmZIZWFkZXJOYW1lIiwieHNyZkNvb2tpZU5hbWUiLCJoZWFkZXJzIiwiYXV0aCIsIkF4aW9zSGVhZGVycyIsImZyb20iLCJ1cmwiLCJidWlsZFVSTCIsImJ1aWxkRnVsbFBhdGgiLCJiYXNlVVJMIiwiYWxsb3dBYnNvbHV0ZVVybHMiLCJwYXJhbXMiLCJwYXJhbXNTZXJpYWxpemVyIiwic2V0IiwiYnRvYSIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJ1bmVzY2FwZSIsImVuY29kZVVSSUNvbXBvbmVudCIsImNvbnRlbnRUeXBlIiwidXRpbHMiLCJpc0Zvcm1EYXRhIiwicGxhdGZvcm0iLCJoYXNTdGFuZGFyZEJyb3dzZXJFbnYiLCJoYXNTdGFuZGFyZEJyb3dzZXJXZWJXb3JrZXJFbnYiLCJzZXRDb250ZW50VHlwZSIsInVuZGVmaW5lZCIsImdldENvbnRlbnRUeXBlIiwidHlwZSIsInRva2VucyIsInNwbGl0IiwibWFwIiwidG9rZW4iLCJ0cmltIiwiZmlsdGVyIiwiQm9vbGVhbiIsImpvaW4iLCJpc0Z1bmN0aW9uIiwiaXNVUkxTYW1lT3JpZ2luIiwieHNyZlZhbHVlIiwiY29va2llcyIsInJlYWQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmVzb2x2ZUNvbmZpZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGxhdGZvcm0gZnJvbSBcIi4uL3BsYXRmb3JtL2luZGV4LmpzXCI7XG5pbXBvcnQgdXRpbHMgZnJvbSBcIi4uL3V0aWxzLmpzXCI7XG5pbXBvcnQgaXNVUkxTYW1lT3JpZ2luIGZyb20gXCIuL2lzVVJMU2FtZU9yaWdpbi5qc1wiO1xuaW1wb3J0IGNvb2tpZXMgZnJvbSBcIi4vY29va2llcy5qc1wiO1xuaW1wb3J0IGJ1aWxkRnVsbFBhdGggZnJvbSBcIi4uL2NvcmUvYnVpbGRGdWxsUGF0aC5qc1wiO1xuaW1wb3J0IG1lcmdlQ29uZmlnIGZyb20gXCIuLi9jb3JlL21lcmdlQ29uZmlnLmpzXCI7XG5pbXBvcnQgQXhpb3NIZWFkZXJzIGZyb20gXCIuLi9jb3JlL0F4aW9zSGVhZGVycy5qc1wiO1xuaW1wb3J0IGJ1aWxkVVJMIGZyb20gXCIuL2J1aWxkVVJMLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IChjb25maWcpID0+IHtcbiAgY29uc3QgbmV3Q29uZmlnID0gbWVyZ2VDb25maWcoe30sIGNvbmZpZyk7XG5cbiAgbGV0IHtkYXRhLCB3aXRoWFNSRlRva2VuLCB4c3JmSGVhZGVyTmFtZSwgeHNyZkNvb2tpZU5hbWUsIGhlYWRlcnMsIGF1dGh9ID0gbmV3Q29uZmlnO1xuXG4gIG5ld0NvbmZpZy5oZWFkZXJzID0gaGVhZGVycyA9IEF4aW9zSGVhZGVycy5mcm9tKGhlYWRlcnMpO1xuXG4gIG5ld0NvbmZpZy51cmwgPSBidWlsZFVSTChidWlsZEZ1bGxQYXRoKG5ld0NvbmZpZy5iYXNlVVJMLCBuZXdDb25maWcudXJsLCBuZXdDb25maWcuYWxsb3dBYnNvbHV0ZVVybHMpLCBjb25maWcucGFyYW1zLCBjb25maWcucGFyYW1zU2VyaWFsaXplcik7XG5cbiAgLy8gSFRUUCBiYXNpYyBhdXRoZW50aWNhdGlvblxuICBpZiAoYXV0aCkge1xuICAgIGhlYWRlcnMuc2V0KCdBdXRob3JpemF0aW9uJywgJ0Jhc2ljICcgK1xuICAgICAgYnRvYSgoYXV0aC51c2VybmFtZSB8fCAnJykgKyAnOicgKyAoYXV0aC5wYXNzd29yZCA/IHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChhdXRoLnBhc3N3b3JkKSkgOiAnJykpXG4gICAgKTtcbiAgfVxuXG4gIGxldCBjb250ZW50VHlwZTtcblxuICBpZiAodXRpbHMuaXNGb3JtRGF0YShkYXRhKSkge1xuICAgIGlmIChwbGF0Zm9ybS5oYXNTdGFuZGFyZEJyb3dzZXJFbnYgfHwgcGxhdGZvcm0uaGFzU3RhbmRhcmRCcm93c2VyV2ViV29ya2VyRW52KSB7XG4gICAgICBoZWFkZXJzLnNldENvbnRlbnRUeXBlKHVuZGVmaW5lZCk7IC8vIExldCB0aGUgYnJvd3NlciBzZXQgaXRcbiAgICB9IGVsc2UgaWYgKChjb250ZW50VHlwZSA9IGhlYWRlcnMuZ2V0Q29udGVudFR5cGUoKSkgIT09IGZhbHNlKSB7XG4gICAgICAvLyBmaXggc2VtaWNvbG9uIGR1cGxpY2F0aW9uIGlzc3VlIGZvciBSZWFjdE5hdGl2ZSBGb3JtRGF0YSBpbXBsZW1lbnRhdGlvblxuICAgICAgY29uc3QgW3R5cGUsIC4uLnRva2Vuc10gPSBjb250ZW50VHlwZSA/IGNvbnRlbnRUeXBlLnNwbGl0KCc7JykubWFwKHRva2VuID0+IHRva2VuLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pIDogW107XG4gICAgICBoZWFkZXJzLnNldENvbnRlbnRUeXBlKFt0eXBlIHx8ICdtdWx0aXBhcnQvZm9ybS1kYXRhJywgLi4udG9rZW5zXS5qb2luKCc7ICcpKTtcbiAgICB9XG4gIH1cblxuICAvLyBBZGQgeHNyZiBoZWFkZXJcbiAgLy8gVGhpcyBpcyBvbmx5IGRvbmUgaWYgcnVubmluZyBpbiBhIHN0YW5kYXJkIGJyb3dzZXIgZW52aXJvbm1lbnQuXG4gIC8vIFNwZWNpZmljYWxseSBub3QgaWYgd2UncmUgaW4gYSB3ZWIgd29ya2VyLCBvciByZWFjdC1uYXRpdmUuXG5cbiAgaWYgKHBsYXRmb3JtLmhhc1N0YW5kYXJkQnJvd3NlckVudikge1xuICAgIHdpdGhYU1JGVG9rZW4gJiYgdXRpbHMuaXNGdW5jdGlvbih3aXRoWFNSRlRva2VuKSAmJiAod2l0aFhTUkZUb2tlbiA9IHdpdGhYU1JGVG9rZW4obmV3Q29uZmlnKSk7XG5cbiAgICBpZiAod2l0aFhTUkZUb2tlbiB8fCAod2l0aFhTUkZUb2tlbiAhPT0gZmFsc2UgJiYgaXNVUkxTYW1lT3JpZ2luKG5ld0NvbmZpZy51cmwpKSkge1xuICAgICAgLy8gQWRkIHhzcmYgaGVhZGVyXG4gICAgICBjb25zdCB4c3JmVmFsdWUgPSB4c3JmSGVhZGVyTmFtZSAmJiB4c3JmQ29va2llTmFtZSAmJiBjb29raWVzLnJlYWQoeHNyZkNvb2tpZU5hbWUpO1xuXG4gICAgICBpZiAoeHNyZlZhbHVlKSB7XG4gICAgICAgIGhlYWRlcnMuc2V0KHhzcmZIZWFkZXJOYW1lLCB4c3JmVmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBuZXdDb25maWc7XG59XG5cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsTUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsTUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsZ0JBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLFFBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLGNBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLFlBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLGFBQUEsR0FBQVAsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFPLFNBQUEsR0FBQVIsc0JBQUEsQ0FBQUMsT0FBQTtBQUFxQyxTQUFBRCx1QkFBQVMsQ0FBQSxXQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUMsVUFBQSxHQUFBRCxDQUFBLEtBQUFFLE9BQUEsRUFBQUYsQ0FBQTtBQUFBLElBQUFHLFFBQUEsR0FFckJDLE1BQU0sSUFBSztFQUN6QixNQUFNQyxTQUFTLEdBQUcsSUFBQUMsb0JBQVcsRUFBQyxDQUFDLENBQUMsRUFBRUYsTUFBTSxDQUFDO0VBRXpDLElBQUk7SUFBQ0csSUFBSTtJQUFFQyxhQUFhO0lBQUVDLGNBQWM7SUFB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
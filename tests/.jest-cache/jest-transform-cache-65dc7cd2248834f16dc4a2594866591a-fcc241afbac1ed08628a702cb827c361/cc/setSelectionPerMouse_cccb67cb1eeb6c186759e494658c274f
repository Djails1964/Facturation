0b9e6cc3d68d9808814030aaea71c457
'use strict';

var UI = require("../../document/UI.js");
require("../../utils/dataTransfer/Clipboard.js");
var selection = require("../../utils/focus/selection.js");
var resolveCaretPosition = require("./resolveCaretPosition.js");
function setSelectionPerMouseDown({
  document,
  target,
  clickCount,
  node,
  offset
}) {
  if (selection.hasNoSelection(target)) {
    return;
  }
  const targetHasOwnSelection = selection.hasOwnSelection(target);
  // On non-input elements the text selection per multiple click
  // can extend beyond the target boundaries.
  // The exact mechanism what is considered in the same line is unclear.
  // Looks it might be every inline element.
  // TODO: Check what might be considered part of the same line of text.
  const text = String(targetHasOwnSelection ? UI.getUIValue(target) : target.textContent);
  const [start, end] = node ?
  // which elements might be considered in the same line of text.
  // TODO: support expanding initial range on multiple clicks if node is given
  [offset, offset] : getTextRange(text, offset, clickCount);
  // TODO: implement modifying selection per shift/ctrl+mouse
  if (targetHasOwnSelection) {
    UI.setUISelection(target, {
      anchorOffset: start !== null && start !== undefined ? start : text.length,
      focusOffset: end !== null && end !== undefined ? end : text.length
    });
    return {
      node: target,
      start: start !== null && start !== undefined ? start : 0,
      end: end !== null && end !== undefined ? end : text.length
    };
  } else {
    const {
      node: startNode,
      offset: startOffset
    } = resolveCaretPosition.resolveCaretPosition({
      target,
      node,
      offset: start
    });
    const {
      node: endNode,
      offset: endOffset
    } = resolveCaretPosition.resolveCaretPosition({
      target,
      node,
      offset: end
    });
    const range = target.ownerDocument.createRange();
    try {
      range.setStart(startNode, startOffset);
      range.setEnd(endNode, endOffset);
    } catch (e) {
      throw new Error('The given offset is out of bounds.');
    }
    const selection = document.getSelection();
    selection === null || selection === undefined ? undefined : selection.removeAllRanges();
    selection === null || selection === undefined ? undefined : selection.addRange(range.cloneRange());
    return range;
  }
}
function getTextRange(text, pos, clickCount) {
  if (clickCount % 3 === 1 || text.length === 0) {
    return [pos, pos];
  }
  const textPos = pos !== null && pos !== undefined ? pos : text.length;
  if (clickCount % 3 === 2) {
    return [textPos - text.substr(0, pos).match(/(\w+|\s+|\W)?$/)[0].length, pos === undefined ? pos : pos + text.substr(pos).match(/^(\w+|\s+|\W)?/)[0].length];
  }
  // triple click
  return [textPos - text.substr(0, pos).match(/[^\r\n]*$/)[0].length, pos === undefined ? pos : pos + text.substr(pos).match(/^[^\r\n]*/)[0].length];
}
exports.setSelectionPerMouseDown = setSelectionPerMouseDown;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVSSIsInJlcXVpcmUiLCJzZWxlY3Rpb24iLCJyZXNvbHZlQ2FyZXRQb3NpdGlvbiIsInNldFNlbGVjdGlvblBlck1vdXNlRG93biIsImRvY3VtZW50IiwidGFyZ2V0IiwiY2xpY2tDb3VudCIsIm5vZGUiLCJvZmZzZXQiLCJoYXNOb1NlbGVjdGlvbiIsInRhcmdldEhhc093blNlbGVjdGlvbiIsImhhc093blNlbGVjdGlvbiIsInRleHQiLCJTdHJpbmciLCJnZXRVSVZhbHVlIiwidGV4dENvbnRlbnQiLCJzdGFydCIsImVuZCIsImdldFRleHRSYW5nZSIsInNldFVJU2VsZWN0aW9uIiwiYW5jaG9yT2Zmc2V0IiwidW5kZWZpbmVkIiwibGVuZ3RoIiwiZm9jdXNPZmZzZXQiLCJzdGFydE5vZGUiLCJzdGFydE9mZnNldCIsImVuZE5vZGUiLCJlbmRPZmZzZXQiLCJyYW5nZSIsIm93bmVyRG9jdW1lbnQiLCJjcmVhdGVSYW5nZSIsInNldFN0YXJ0Iiwic2V0RW5kIiwiZSIsIkVycm9yIiwiZ2V0U2VsZWN0aW9uIiwicmVtb3ZlQWxsUmFuZ2VzIiwiYWRkUmFuZ2UiLCJjbG9uZVJhbmdlIiwicG9zIiwidGV4dFBvcyIsInN1YnN0ciIsIm1hdGNoIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInNldFNlbGVjdGlvblBlck1vdXNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIFVJID0gcmVxdWlyZSgnLi4vLi4vZG9jdW1lbnQvVUkuanMnKTtcbnJlcXVpcmUoJy4uLy4uL3V0aWxzL2RhdGFUcmFuc2Zlci9DbGlwYm9hcmQuanMnKTtcbnZhciBzZWxlY3Rpb24gPSByZXF1aXJlKCcuLi8uLi91dGlscy9mb2N1cy9zZWxlY3Rpb24uanMnKTtcbnZhciByZXNvbHZlQ2FyZXRQb3NpdGlvbiA9IHJlcXVpcmUoJy4vcmVzb2x2ZUNhcmV0UG9zaXRpb24uanMnKTtcblxuZnVuY3Rpb24gc2V0U2VsZWN0aW9uUGVyTW91c2VEb3duKHsgZG9jdW1lbnQsIHRhcmdldCwgY2xpY2tDb3VudCwgbm9kZSwgb2Zmc2V0IH0pIHtcbiAgICBpZiAoc2VsZWN0aW9uLmhhc05vU2VsZWN0aW9uKHRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXRIYXNPd25TZWxlY3Rpb24gPSBzZWxlY3Rpb24uaGFzT3duU2VsZWN0aW9uKHRhcmdldCk7XG4gICAgLy8gT24gbm9uLWlucHV0IGVsZW1lbnRzIHRoZSB0ZXh0IHNlbGVjdGlvbiBwZXIgbXVsdGlwbGUgY2xpY2tcbiAgICAvLyBjYW4gZXh0ZW5kIGJleW9uZCB0aGUgdGFyZ2V0IGJvdW5kYXJpZXMuXG4gICAgLy8gVGhlIGV4YWN0IG1lY2hhbmlzbSB3aGF0IGlzIGNvbnNpZGVyZWQgaW4gdGhlIHNhbWUgbGluZSBpcyB1bmNsZWFyLlxuICAgIC8vIExvb2tzIGl0IG1pZ2h0IGJlIGV2ZXJ5IGlubGluZSBlbGVtZW50LlxuICAgIC8vIFRPRE86IENoZWNrIHdoYXQgbWlnaHQgYmUgY29uc2lkZXJlZCBwYXJ0IG9mIHRoZSBzYW1lIGxpbmUgb2YgdGV4dC5cbiAgICBjb25zdCB0ZXh0ID0gU3RyaW5nKHRhcmdldEhhc093blNlbGVjdGlvbiA/IFVJLmdldFVJVmFsdWUodGFyZ2V0KSA6IHRhcmdldC50ZXh0Q29udGVudCk7XG4gICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gbm9kZSA/IC8vIHdoaWNoIGVsZW1lbnRzIG1pZ2h0IGJlIGNvbnNpZGVyZWQgaW4gdGhlIHNhbWUgbGluZSBvZiB0ZXh0LlxuICAgIC8vIFRPRE86IHN1cHBvcnQgZXhwYW5kaW5nIGluaXRpYWwgcmFuZ2Ugb24gbXVsdGlwbGUgY2xpY2tzIGlmIG5vZGUgaXMgZ2l2ZW5cbiAgICBbXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgb2Zmc2V0XG4gICAgXSA6IGdldFRleHRSYW5nZSh0ZXh0LCBvZmZzZXQsIGNsaWNrQ291bnQpO1xuICAgIC8vIFRPRE86IGltcGxlbWVudCBtb2RpZnlpbmcgc2VsZWN0aW9uIHBlciBzaGlmdC9jdHJsK21vdXNlXG4gICAgaWYgKHRhcmdldEhhc093blNlbGVjdGlvbikge1xuICAgICAgICBVSS5zZXRVSVNlbGVjdGlvbih0YXJnZXQsIHtcbiAgICAgICAgICAgIGFuY2hvck9mZnNldDogc3RhcnQgIT09IG51bGwgJiYgc3RhcnQgIT09IHVuZGVmaW5lZCA/IHN0YXJ0IDogdGV4dC5sZW5ndGgsXG4gICAgICAgICAgICBmb2N1c09mZnNldDogZW5kICE9PSBudWxsICYmIGVuZCAhPT0gdW5kZWZpbmVkID8gZW5kIDogdGV4dC5sZW5ndGhcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlOiB0YXJnZXQsXG4gICAgICAgICAgICBzdGFydDogc3RhcnQgIT09IG51bGwgJiYgc3RhcnQgIT09IHVuZGVmaW5lZCA/IHN0YXJ0IDogMCxcbiAgICAgICAgICAgIGVuZDogZW5kICE9PSBudWxsICYmIGVuZCAhPT0gdW5kZWZpbmVkID8gZW5kIDogdGV4dC5sZW5ndGhcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB7IG5vZGU6IHN0YXJ0Tm9kZSwgb2Zmc2V0OiBzdGFydE9mZnNldCB9ID0gcmVzb2x2ZUNhcmV0UG9zaXRpb24ucmVzb2x2ZUNhcmV0UG9zaXRpb24oe1xuICAgICAgICAgICAgdGFyZ2V0LFxuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIG9mZnNldDogc3RhcnRcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHsgbm9kZTogZW5kTm9kZSwgb2Zmc2V0OiBlbmRPZmZzZXQgfSA9IHJlc29sdmVDYXJldFBvc2l0aW9uLnJlc29sdmVDYXJldFBvc2l0aW9uKHtcbiAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICBvZmZzZXQ6IGVuZFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSB0YXJnZXQub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnQoc3RhcnROb2RlLCBzdGFydE9mZnNldCk7XG4gICAgICAgICAgICByYW5nZS5zZXRFbmQoZW5kTm9kZSwgZW5kT2Zmc2V0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgZ2l2ZW4gb2Zmc2V0IGlzIG91dCBvZiBib3VuZHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIHNlbGVjdGlvbiA9PT0gbnVsbCB8fCBzZWxlY3Rpb24gPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgc2VsZWN0aW9uID09PSBudWxsIHx8IHNlbGVjdGlvbiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlLmNsb25lUmFuZ2UoKSk7XG4gICAgICAgIHJldHVybiByYW5nZTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRUZXh0UmFuZ2UodGV4dCwgcG9zLCBjbGlja0NvdW50KSB7XG4gICAgaWYgKGNsaWNrQ291bnQgJSAzID09PSAxIHx8IHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBwb3MsXG4gICAgICAgICAgICBwb3NcbiAgICAgICAgXTtcbiAgICB9XG4gICAgY29uc3QgdGV4dFBvcyA9IHBvcyAhPT0gbnVsbCAmJiBwb3MgIT09IHVuZGVmaW5lZCA/IHBvcyA6IHRleHQubGVuZ3RoO1xuICAgIGlmIChjbGlja0NvdW50ICUgMyA9PT0gMikge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgdGV4dFBvcyAtIHRleHQuc3Vic3RyKDAsIHBvcykubWF0Y2goLyhcXHcrfFxccyt8XFxXKT8kLylbMF0ubGVuZ3RoLFxuICAgICAgICAgICAgcG9zID09PSB1bmRlZmluZWQgPyBwb3MgOiBwb3MgKyB0ZXh0LnN1YnN0cihwb3MpLm1hdGNoKC9eKFxcdyt8XFxzK3xcXFcpPy8pWzBdLmxlbmd0aFxuICAgICAgICBdO1xuICAgIH1cbiAgICAvLyB0cmlwbGUgY2xpY2tcbiAgICByZXR1cm4gW1xuICAgICAgICB0ZXh0UG9zIC0gdGV4dC5zdWJzdHIoMCwgcG9zKS5tYXRjaCgvW15cXHJcXG5dKiQvKVswXS5sZW5ndGgsXG4gICAgICAgIHBvcyA9PT0gdW5kZWZpbmVkID8gcG9zIDogcG9zICsgdGV4dC5zdWJzdHIocG9zKS5tYXRjaCgvXlteXFxyXFxuXSovKVswXS5sZW5ndGhcbiAgICBdO1xufVxuXG5leHBvcnRzLnNldFNlbGVjdGlvblBlck1vdXNlRG93biA9IHNldFNlbGVjdGlvblBlck1vdXNlRG93bjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWixJQUFJQSxFQUFFLEdBQUdDLE9BQU8sdUJBQXVCLENBQUM7QUFDeENBLE9BQU8sd0NBQXdDLENBQUM7QUFDaEQsSUFBSUMsU0FBUyxHQUFHRCxPQUFPLGlDQUFpQyxDQUFDO0FBQ3pELElBQUlFLG9CQUFvQixHQUFHRixPQUFPLDRCQUE0QixDQUFDO0FBRS9ELFNBQVNHLHdCQUF3QkEsQ0FBQztFQUFFQyxRQUFRO0VBQUVDLE1BQU07RUFBRUMsVUFBVTtFQUFFQyxJQUFJO0VBQUVDO0FBQU8sQ0FBQyxFQUFFO0VBQzlFLElBQUlQLFNBQVMsQ0FBQ1EsY0FBYyxDQUFDSixNQUFNLENBQUMsRUFBRTtJQUNsQztFQUNKO0VBQ0EsTUFBTUsscUJBQXFCLEdBQUdULFNBQVMsQ0FBQ1UsZUFBZSxDQUFDTixNQUFNLENBQUM7RUFDL0Q7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBLE1BQU1PLElBQUksR0FBR0MsTUFBTSxDQUFDSCxxQkFBcUIsR0FBR1gsRUFBRSxDQUFDZSxVQUFVLENBQUNULE1BQU0sQ0FBQyxHQUFHQSxNQUFNLENBQUNVLFdBQVcsQ0FBQztF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